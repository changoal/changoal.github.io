<!DOCTYPE html>
<html  lang="zh">
<head>
    <meta charset="utf-8">
<title>分类: Android - changoal</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />



    <meta name="description" content="十年之前和现�?">
<meta property="og:type" content="website">
<meta property="og:title" content="changoal">
<meta property="og:url" content="http://yoursite.com/categories/Android/index.html">
<meta property="og:site_name" content="changoal">
<meta property="og:description" content="十年之前和现�?">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="changoal">
<meta name="twitter:description" content="十年之前和现�?">





<link rel="icon" href="/images/icon_round.png">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">
<link rel="stylesheet" href="/css/style.css">


    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">
    

    
    
    
    <style>body{opacity: 0}</style>
    

    
    
    
    


    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-105599788-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-105599788-1');
</script>


    
    
    
    

    


</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/icon_round.png" alt="" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/">Home</a>
                
                <a class="navbar-item"
                href="/archives">Archives</a>
                
                <a class="navbar-item"
                href="/categories">Categories</a>
                
                <a class="navbar-item"
                href="/tags">Tags</a>
                
                <a class="navbar-item"
                href="/about">About</a>
                
            </div>
            
            <div class="navbar-end">
                
                
                <a class="navbar-item search" title="搜索" href="javascript:;">
                    <i class="material-icons is-size-5">search</i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns main">
                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2"><div class="card">
    <div class="card-content">
        <nav class="breadcrumb" aria-label="breadcrumbs">
        <ul>
            <li><a href="/categories">分类</a></li>
            
            <li class="is-active"><a href="#" aria-current="page">Android</a></li>
        </ul>
        </nav>
    </div>
</div>

    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-09-28T10:46:37.000Z">2018-09-28</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Android/">Android</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    8 分钟 读完 (大约 1199 个字)
                </span>
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/09/28/Android流行ORM框架/">Android流行ORM框架</a>
            
        </h1>
        <div class="content">
            <h1 id="Android-ORM框架"><a href="#Android-ORM框架" class="headerlink" title="Android ORM框架"></a>Android ORM框架</h1><h2 id="Room"><a href="#Room" class="headerlink" title="Room"></a><a href="https://developer.android.com/training/data-storage/room/" target="_blank" rel="noopener">Room</a></h2><figure class="highlight gradle hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">def</span> room_version = <span class="hljs-string">"1.1.1"</span></span><br><span class="line">implementation <span class="hljs-string">"android.arch.persistence.room:runtime:$room_version"</span></span><br><span class="line">annotationProcessor <span class="hljs-string">"android.arch.persistence.room:compiler:$room_version"</span></span><br><span class="line">implementation <span class="hljs-string">"android.arch.persistence.room:rxjava2:$room_version"</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Entity</span>(tableName = <span class="hljs-string">"user"</span>)</span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@PrimaryKey</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@ColumnInfo</span>(name = <span class="hljs-string">"first_name"</span>)</span><br><span class="line">    <span class="hljs-keyword">private</span> String firstName;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@ColumnInfo</span>(name = <span class="hljs-string">"last_name"</span>)</span><br><span class="line">    <span class="hljs-keyword">private</span> String lastName;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Ignore</span></span><br><span class="line">    <span class="hljs-keyword">private</span> String nickName;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getId</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setId</span><span class="hljs-params">(<span class="hljs-keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getFirstName</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> firstName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setFirstName</span><span class="hljs-params">(String firstName)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">this</span>.firstName = firstName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getLastName</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> lastName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setLastName</span><span class="hljs-params">(String lastName)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">this</span>.lastName = lastName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Dao</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Query</span>(<span class="hljs-string">"select * from user"</span>)</span><br><span class="line">    <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">getAll</span><span class="hljs-params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Query</span>(<span class="hljs-string">"select * from user where id in (:ids)"</span>)</span><br><span class="line">    <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">queryUserByIds</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] ids)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Query</span>(<span class="hljs-string">"select * from user where first_name like :first and last_name like :last limit 1"</span>)</span><br><span class="line">    <span class="hljs-function">User <span class="hljs-title">findByName</span><span class="hljs-params">(String first, String last)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Insert</span>(onConflict = REPLACE)</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">insertAll</span><span class="hljs-params">(User... users)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Delete</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delete</span><span class="hljs-params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Query</span>(<span class="hljs-string">"SELECT * from user where id = :id LIMIT 1"</span>)</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> Flowable&lt;User&gt; <span class="hljs-title">loadUserById</span><span class="hljs-params">(<span class="hljs-keyword">int</span> id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Database</span>(entities = &#123;User.class&#125;, version = <span class="hljs-number">1</span>)</span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppDatabase</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RoomDatabase</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> UserDao <span class="hljs-title">userDao</span><span class="hljs-params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight kotlin hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testRoom</span><span class="hljs-params">()</span></span> &#123;</span><br><span class="line">    <span class="hljs-keyword">val</span> db = Room.databaseBuilder(applicationContext,</span><br><span class="line">            AppDatabase::<span class="hljs-class"><span class="hljs-keyword">class</span>.<span class="hljs-title">java</span>, <span class="hljs-type">"database-name").build</span></span>()</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">var</span> all = db.userDao().all</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">val</span> MIGRATION_1_2 = <span class="hljs-keyword">object</span> : Migration(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>) &#123;</span><br><span class="line">        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">migrate</span><span class="hljs-params">(database: <span class="hljs-type">SupportSQLiteDatabase</span>)</span></span> &#123;</span><br><span class="line">            database.execSQL(<span class="hljs-string">"CREATE TABLE `Fruit` (`id` INTEGER, "</span> + <span class="hljs-string">"`name` TEXT, PRIMARY KEY(`id`))"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">val</span> MIGRATION_2_3 = <span class="hljs-keyword">object</span> : Migration(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>) &#123;</span><br><span class="line">        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">migrate</span><span class="hljs-params">(database: <span class="hljs-type">SupportSQLiteDatabase</span>)</span></span> &#123;</span><br><span class="line">            database.execSQL(<span class="hljs-string">"ALTER TABLE Book "</span></span><br><span class="line">                    + <span class="hljs-string">" ADD COLUMN pub_year INTEGER"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Room.databaseBuilder(applicationContext, AppDatabase::<span class="hljs-class"><span class="hljs-keyword">class</span>.<span class="hljs-title">java</span>, <span class="hljs-type">"database-name")</span></span></span><br><span class="line">                .addMigrations(MIGRATION_1_2, MIGRATION_2_3).build()</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="GreenDao"><a href="#GreenDao" class="headerlink" title="GreenDao"></a><a href="https://github.com/greenrobot/greenDAO" target="_blank" rel="noopener">GreenDao</a></h2><h2 id="Realm"><a href="#Realm" class="headerlink" title="Realm"></a><a href="https://github.com/realm/realm-java" target="_blank" rel="noopener">Realm</a></h2><figure class="highlight gradle hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// product</span></span><br><span class="line"><span class="hljs-keyword">buildscript</span> &#123;</span><br><span class="line">    <span class="hljs-keyword">repositories</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">        maven &#123;url <span class="hljs-string">'http://oss.jfrog.org/artifactory/oss-snapshot-local'</span>&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">dependencies</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="hljs-keyword">classpath</span> <span class="hljs-string">"io.realm:realm-gradle-plugin:5.8.0-SNAPSHOT"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">allprojects</span> &#123;</span><br><span class="line">    <span class="hljs-keyword">repositories</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">        maven &#123;url <span class="hljs-string">'http://oss.jfrog.org/artifactory/oss-snapshot-local'</span>&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// module</span></span><br><span class="line">apply plugin: <span class="hljs-string">'realm-android'</span></span><br></pre></td></tr></table></figure>
<figure class="highlight kotlin hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseApplication</span> : <span class="hljs-type">Application</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">()</span></span> &#123;</span><br><span class="line">        <span class="hljs-keyword">super</span>.onCreate()</span><br><span class="line">        Realm.init(<span class="hljs-keyword">this</span>);</span><br><span class="line">        <span class="hljs-keyword">val</span> config = RealmConfiguration.Builder().build()</span><br><span class="line">        Realm.setDefaultConfiguration(config)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight kotlin hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// 新建一个对象，并进行存储</span></span><br><span class="line"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testCreateRealm</span><span class="hljs-params">()</span></span> &#123;</span><br><span class="line">    <span class="hljs-keyword">val</span> realm = Realm.getDefaultInstance()</span><br><span class="line">    realm.beginTransaction()</span><br><span class="line">    <span class="hljs-keyword">val</span> user = realm.createObject(User::<span class="hljs-class"><span class="hljs-keyword">class</span>.<span class="hljs-title">java</span>)</span></span><br><span class="line">    user.firstName = <span class="hljs-string">"lalla"</span></span><br><span class="line">    user.lastName = <span class="hljs-string">"aaaa"</span></span><br><span class="line">    realm.commitTransaction()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 复制一个对象到Realm数据库</span></span><br><span class="line"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">copyToRealm</span><span class="hljs-params">()</span></span> &#123;</span><br><span class="line">    <span class="hljs-keyword">val</span> realm = Realm.getDefaultInstance()</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">val</span> user = User()</span><br><span class="line">    user.firstName = <span class="hljs-string">"lalla"</span></span><br><span class="line">    user.lastName = <span class="hljs-string">"aaaa"</span></span><br><span class="line"></span><br><span class="line">    realm.beginTransaction()</span><br><span class="line">    realm.copyToRealm(user)</span><br><span class="line">    realm.commitTransaction()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 使用事务块</span></span><br><span class="line"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testExecuteTransaction</span><span class="hljs-params">()</span></span> &#123;</span><br><span class="line">    <span class="hljs-keyword">val</span> realm = Realm.getDefaultInstance()</span><br><span class="line">    <span class="hljs-keyword">val</span> user = realm.createObject(User::<span class="hljs-class"><span class="hljs-keyword">class</span>.<span class="hljs-title">java</span>)</span></span><br><span class="line">    user.firstName = <span class="hljs-string">"lalla"</span></span><br><span class="line">    user.lastName = <span class="hljs-string">"aaaa"</span></span><br><span class="line"></span><br><span class="line">    realm.executeTransaction &#123;</span><br><span class="line">        it.copyToRealm(user)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testDelete</span><span class="hljs-params">()</span></span> &#123;</span><br><span class="line">    <span class="hljs-keyword">val</span> realm = Realm.getDefaultInstance()</span><br><span class="line">    <span class="hljs-keyword">val</span> users = realm.where(User::<span class="hljs-class"><span class="hljs-keyword">class</span>.<span class="hljs-title">java</span>).<span class="hljs-title">findAll</span></span>()</span><br><span class="line">    realm.executeTransaction &#123;</span><br><span class="line">        <span class="hljs-keyword">val</span> user = users[<span class="hljs-number">1</span>]</span><br><span class="line">        user?.deleteFromRealm()</span><br><span class="line">        <span class="hljs-comment">//删除第一个数据</span></span><br><span class="line">        users.deleteFirstFromRealm()</span><br><span class="line">        <span class="hljs-comment">//删除最后一个数据</span></span><br><span class="line">        users.deleteLastFromRealm()</span><br><span class="line">        <span class="hljs-comment">//删除位置为1的数据</span></span><br><span class="line">        users.deleteFromRealm(<span class="hljs-number">1</span>)</span><br><span class="line">        <span class="hljs-comment">//删除所有数据</span></span><br><span class="line">        users.deleteAllFromRealm()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testUpdate</span><span class="hljs-params">()</span></span> &#123;</span><br><span class="line">    <span class="hljs-keyword">val</span> realm = Realm.getDefaultInstance()</span><br><span class="line">    <span class="hljs-keyword">val</span> user = realm.where(User::<span class="hljs-class"><span class="hljs-keyword">class</span>.<span class="hljs-title">java</span>).<span class="hljs-title">equalTo</span></span>(<span class="hljs-string">"id"</span>, <span class="hljs-string">"1"</span>).findFirst()</span><br><span class="line">    realm.beginTransaction()</span><br><span class="line">    user?.firstName = <span class="hljs-string">"1111"</span></span><br><span class="line">    realm.commitTransaction()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testQuery</span><span class="hljs-params">()</span></span> &#123;</span><br><span class="line">    <span class="hljs-keyword">val</span> realm = Realm.getDefaultInstance()</span><br><span class="line">    <span class="hljs-keyword">val</span> users = realm.where(User::<span class="hljs-class"><span class="hljs-keyword">class</span>.<span class="hljs-title">java</span>).<span class="hljs-title">findAll</span></span>()</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">var</span> average = users.average(<span class="hljs-string">"age"</span>)</span><br><span class="line">    <span class="hljs-keyword">var</span> max = users.max(<span class="hljs-string">"age"</span>)</span><br><span class="line">    <span class="hljs-keyword">var</span> sort = users.sort(<span class="hljs-string">"age"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">val</span> user = realm.where(User::<span class="hljs-class"><span class="hljs-keyword">class</span>.<span class="hljs-title">java</span>).<span class="hljs-title">equalTo</span></span>(<span class="hljs-string">"id"</span>, <span class="hljs-string">"1"</span>).findFirst()</span><br><span class="line">    <span class="hljs-keyword">val</span> user1 = realm.where(User::<span class="hljs-class"><span class="hljs-keyword">class</span>.<span class="hljs-title">java</span>).<span class="hljs-title">between</span></span>(<span class="hljs-string">"age"</span>, <span class="hljs-number">1</span>, <span class="hljs-number">10</span>).findFirst()</span><br><span class="line">    <span class="hljs-keyword">val</span> user2 = realm.where(User::<span class="hljs-class"><span class="hljs-keyword">class</span>.<span class="hljs-title">java</span>).<span class="hljs-title">lessThan</span></span>(<span class="hljs-string">"id"</span>, <span class="hljs-number">1</span>).findFirst()</span><br><span class="line">    <span class="hljs-keyword">val</span> user3 = realm.where(User::<span class="hljs-class"><span class="hljs-keyword">class</span>.<span class="hljs-title">java</span>).<span class="hljs-title">contains</span></span>(<span class="hljs-string">"id"</span>, <span class="hljs-string">"1"</span>).findFirst()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="DBFlow"><a href="#DBFlow" class="headerlink" title="DBFlow"></a><a href="https://github.com/Raizlabs/DBFlow" target="_blank" rel="noopener">DBFlow</a></h2><figure class="highlight gradle hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// product</span></span><br><span class="line"><span class="hljs-keyword">allprojects</span> &#123;</span><br><span class="line">    <span class="hljs-keyword">repositories</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">        maven &#123; url <span class="hljs-string">"https://www.jitpack.io"</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// module</span></span><br><span class="line"><span class="hljs-keyword">dependencies</span> &#123;</span><br><span class="line">    <span class="hljs-comment">// if Java use this. If using Kotlin do NOT use this.</span></span><br><span class="line">    annotationProcessor <span class="hljs-string">"com.github.Raizlabs.DBFlow:dbflow-processor:$&#123;dbflow_version&#125;"</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// Use if Kotlin user.</span></span><br><span class="line">    kapt <span class="hljs-string">"com.github.Raizlabs.DBFlow:dbflow-processor:$&#123;dbflow_version&#125;"</span></span><br><span class="line"></span><br><span class="line">    implementation <span class="hljs-string">"com.github.Raizlabs.DBFlow:dbflow-core:$&#123;dbflow_version&#125;"</span></span><br><span class="line">    implementation <span class="hljs-string">"com.github.Raizlabs.DBFlow:dbflow:$&#123;dbflow_version&#125;"</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// sql-cipher database encryption (optional)</span></span><br><span class="line">    implementation <span class="hljs-string">"com.github.Raizlabs.DBFlow:dbflow-sqlcipher:$&#123;dbflow_version&#125;"</span></span><br><span class="line">    implementation <span class="hljs-string">"net.zetetic:android-database-sqlcipher:$&#123;sqlcipher_version&#125;@aar"</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// kotlin extensions</span></span><br><span class="line">    implementation <span class="hljs-string">"com.github.Raizlabs.DBFlow:dbflow-kotlinextensions:$&#123;dbflow_version&#125;"</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// RXJava 2 support</span></span><br><span class="line">    implementation <span class="hljs-string">"com.github.Raizlabs.DBFlow:dbflow-rx2:$&#123;dbflow_version&#125;"</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// RXJava 2 Kotlin Extensions Support</span></span><br><span class="line">    implementation <span class="hljs-string">"com.github.Raizlabs.DBFlow:dbflow-rx2-kotlinextensions:$&#123;dbflow_version&#125;"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight kotlin hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseApplication</span> : <span class="hljs-type">Application</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">()</span></span> &#123;</span><br><span class="line">        <span class="hljs-keyword">super</span>.onCreate()</span><br><span class="line">        FlowManager.init(<span class="hljs-keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Database</span>(version = VERSION, name = NAME)</span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DBFlowDataBase</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//数据库名称</span></span><br><span class="line">    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String NAME = <span class="hljs-string">"RuomizDataBase"</span>;</span><br><span class="line">    <span class="hljs-comment">//数据库版本</span></span><br><span class="line">    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> VERSION = <span class="hljs-number">1</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Table</span>(database = DBFlowDataBase.class)</span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DBFlowModel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseModel</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@PrimaryKey</span>(autoincrement = <span class="hljs-keyword">true</span>)</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Column</span></span><br><span class="line">    <span class="hljs-keyword">public</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Column</span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Column</span></span><br><span class="line">    <span class="hljs-keyword">public</span> String address;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Column</span></span><br><span class="line">    <span class="hljs-keyword">public</span> String phone;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译之后</p>
<figure class="highlight kotlin hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testDBFlow</span><span class="hljs-params">()</span></span> &#123;</span><br><span class="line">    <span class="hljs-keyword">val</span> dbFlowModel = DBFlowModel()</span><br><span class="line">    dbFlowModel.name = <span class="hljs-string">"Ruomiz"</span></span><br><span class="line">    dbFlowModel.address = <span class="hljs-string">"beijing"</span></span><br><span class="line">    dbFlowModel.age = <span class="hljs-number">100</span></span><br><span class="line">    dbFlowModel.phone = <span class="hljs-string">"13333333333"</span></span><br><span class="line">    dbFlowModel.save()</span><br><span class="line">    dbFlowModel.update()</span><br><span class="line">    dbFlowModel.delete()</span><br><span class="line">    dbFlowModel.insert()</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//根据name 单个查询</span></span><br><span class="line">    <span class="hljs-keyword">val</span> dbFlowModel1 = Select().from(DBFlowModel::<span class="hljs-class"><span class="hljs-keyword">class</span>.<span class="hljs-title">java</span>).<span class="hljs-title">where</span></span>(DBFlowModel_Table.name.`<span class="hljs-keyword">is</span>`(name)).querySingle()</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//单个查询</span></span><br><span class="line">    <span class="hljs-keyword">val</span> dbFlowDataBase = Select().from(DBFlowDataBase::<span class="hljs-class"><span class="hljs-keyword">class</span>.<span class="hljs-title">java</span>).<span class="hljs-title">querySingle</span></span>()</span><br><span class="line">    <span class="hljs-comment">//返回所有结果</span></span><br><span class="line">    <span class="hljs-keyword">val</span> dbFlowDataBases = Select().from(DBFlowDataBase::<span class="hljs-class"><span class="hljs-keyword">class</span>.<span class="hljs-title">java</span>).<span class="hljs-title">queryList</span></span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="OrmLite"><a href="#OrmLite" class="headerlink" title="OrmLite"></a><a href="https://github.com/j256/ormlite-android" target="_blank" rel="noopener">OrmLite</a></h2><p>下载地址：<a href="http://ormlite.com/releases/" target="_blank" rel="noopener">http://ormlite.com/releases/</a></p>
<p>需要下载最新的 core.jar 和 android.jar 并添加依赖</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@DatabaseTable</span>(tableName = <span class="hljs-string">"user"</span>)</span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@DatabaseField</span>(generatedId = <span class="hljs-keyword">true</span>)<span class="hljs-comment">//表示id为主键且自动生成</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@DatabaseField</span>(columnName = <span class="hljs-string">"first_name"</span>)</span><br><span class="line">    <span class="hljs-keyword">private</span> String firstName;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@DatabaseField</span>(columnName = <span class="hljs-string">"last_name"</span>)</span><br><span class="line">    <span class="hljs-keyword">private</span> String lastName;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getId</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setId</span><span class="hljs-params">(<span class="hljs-keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getFirstName</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> firstName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setFirstName</span><span class="hljs-params">(String firstName)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">this</span>.firstName = firstName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getLastName</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> lastName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setLastName</span><span class="hljs-params">(String lastName)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">this</span>.lastName = lastName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DatabaseHelper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">OrmLiteSqliteOpenHelper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String TABLE_NAME = <span class="hljs-string">"sqlite-test.db"</span>;</span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * userDao ，每张表对于一个</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">private</span> Dao&lt;User, Integer&gt; userDao;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DatabaseHelper</span><span class="hljs-params">(Context context, String databaseName,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        CursorFactory factory, <span class="hljs-keyword">int</span> databaseVersion)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">super</span>(context, databaseName, factory, databaseVersion);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(SQLiteDatabase sqLiteDatabase, ConnectionSource connectionSource)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">            TableUtils.createTable(connectionSource, User.class);</span><br><span class="line">        &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onUpgrade</span><span class="hljs-params">(SQLiteDatabase sqLiteDatabase, ConnectionSource connectionSource,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">int</span> oldVersion, <span class="hljs-keyword">int</span> newVersion)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">            TableUtils.dropTable(connectionSource, User.class, <span class="hljs-keyword">true</span>);</span><br><span class="line">            onCreate(sqLiteDatabase, connectionSource);</span><br><span class="line">        &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">insertUser</span><span class="hljs-params">(User user)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        getUserDao().create(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteUserById</span><span class="hljs-params">(<span class="hljs-keyword">int</span> id, User user)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        getUserDao().deleteById(id);</span><br><span class="line">        getUserDao().delete(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateData</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        UpdateBuilder&lt;User, Integer&gt; updateBuilder = getUserDao().updateBuilder();</span><br><span class="line">        updateBuilder.setWhere(updateBuilder.where().eq(<span class="hljs-string">"name"</span>, <span class="hljs-string">"jack"</span>).and().gt(<span class="hljs-string">"age"</span>, <span class="hljs-number">19</span>));</span><br><span class="line">        updateBuilder.updateColumnValue(<span class="hljs-string">"name"</span>, <span class="hljs-string">"Jack"</span>);</span><br><span class="line">        updateBuilder.updateColumnValue(<span class="hljs-string">"phone"</span>, <span class="hljs-string">"1111765765"</span>);</span><br><span class="line">        updateBuilder.update();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">query</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        List&lt;User&gt; users = getUserDao().queryForAll();</span><br><span class="line"></span><br><span class="line">        User user = getUserDao().queryForId(<span class="hljs-number">3</span>);</span><br><span class="line"></span><br><span class="line">        List&lt;User&gt; jsckUser = getUserDao().queryForEq(<span class="hljs-string">"name"</span>, <span class="hljs-string">"Jack"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 获得userDao</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> Dao&lt;User, Integer&gt; <span class="hljs-title">getUserDao</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (userDao == <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">            userDao = getDao(User.class);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">return</span> userDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 释放资源</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">close</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">super</span>.close();</span><br><span class="line">        userDao = <span class="hljs-keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="分析及对比"><a href="#分析及对比" class="headerlink" title="分析及对比"></a>分析及对比</h2><ul>
<li><a href="https://juejin.im/post/5958fe70f265da6c49777c94" target="_blank" rel="noopener">Android目前流行三方数据库ORM分析及对比</a></li>
</ul>

        </div>
        
        
        
    </div>
</div>





    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-09-26T07:29:53.000Z">2018-09-26</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Android/">Android</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    8 分钟 读完 (大约 1186 个字)
                </span>
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/09/26/懒加载-fragment/">懒加载 fragment</a>
            
        </h1>
        <div class="content">
            <figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseLazyFragment</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Fragment</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">protected</span> View mRootView;</span><br><span class="line">    <span class="hljs-keyword">protected</span> Context mContext;</span><br><span class="line">    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">boolean</span> isVisible;</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> isPrepared;</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> isFirst = <span class="hljs-keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onActivityCreated</span><span class="hljs-params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">super</span>.onActivityCreated(savedInstanceState);</span><br><span class="line">        isPrepared = <span class="hljs-keyword">true</span>;</span><br><span class="line">        initPrepare();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUserVisibleHint</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> isVisibleToUser)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">super</span>.setUserVisibleHint(isVisibleToUser);</span><br><span class="line">        <span class="hljs-keyword">if</span> (getUserVisibleHint()) &#123;</span><br><span class="line">            isVisible = <span class="hljs-keyword">true</span>;</span><br><span class="line">            lazyLoad();</span><br><span class="line">        &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            isVisible = <span class="hljs-keyword">false</span>;</span><br><span class="line">            onInvisible();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onResume</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">super</span>.onResume();</span><br><span class="line">        <span class="hljs-keyword">if</span> (getUserVisibleHint()) &#123;</span><br><span class="line">            setUserVisibleHint(<span class="hljs-keyword">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        mContext = getActivity();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Nullable</span></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> View <span class="hljs-title">onCreateView</span><span class="hljs-params">(LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (mRootView == <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">            mRootView = initView(inflater, container, savedInstanceState);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">return</span> mRootView;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//--------------------------------method---------------------------//</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 懒加载</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">lazyLoad</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (!isPrepared || !isVisible || !isFirst) &#123;</span><br><span class="line">            <span class="hljs-keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        initData();</span><br><span class="line">        isFirst = <span class="hljs-keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//--------------------------abstract method------------------------//</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 在onActivityCreated中调用的方法，可以用来进行初始化操作。</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initPrepare</span><span class="hljs-params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * fragment被设置为不可见时调用</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onInvisible</span><span class="hljs-params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 这里获取数据，刷新界面</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initData</span><span class="hljs-params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 初始化布局，请不要把耗时操作放在这个方法里，这个方法用来提供一个</span></span><br><span class="line"><span class="hljs-comment">     * 基本的布局而非一个完整的布局，以免ViewPager预加载消耗大量的资源。</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> View <span class="hljs-title">initView</span><span class="hljs-params">(LayoutInflater inflater,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                                     @Nullable ViewGroup container,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                                     @Nullable Bundle savedInstanceState)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="多层嵌套后的-Fragment-懒加载实现"><a href="#多层嵌套后的-Fragment-懒加载实现" class="headerlink" title="多层嵌套后的 Fragment 懒加载实现"></a><a href="https://juejin.im/post/5adcb0e36fb9a07aa7673fbc" target="_blank" rel="noopener">多层嵌套后的 Fragment 懒加载实现</a></h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="hljs-keyword">import</span> android.support.annotation.NonNull;</span><br><span class="line"><span class="hljs-keyword">import</span> android.support.annotation.Nullable;</span><br><span class="line"><span class="hljs-keyword">import</span> android.support.v4.app.Fragment;</span><br><span class="line"><span class="hljs-keyword">import</span> android.support.v4.app.FragmentManager;</span><br><span class="line"><span class="hljs-keyword">import</span> android.view.LayoutInflater;</span><br><span class="line"><span class="hljs-keyword">import</span> android.view.View;</span><br><span class="line"><span class="hljs-keyword">import</span> android.view.ViewGroup;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> wangshijia</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2018/2/2</span></span><br><span class="line"><span class="hljs-comment"> * Fragment 第一次可见状态应该在哪里通知用户 在 onResume 以后？</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LazyLoadBaseFragment</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseLifeCircleFragment</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">protected</span> View rootView = <span class="hljs-keyword">null</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> mIsFirstVisible = <span class="hljs-keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> isViewCreated = <span class="hljs-keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> currentVisibleState = <span class="hljs-keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> View <span class="hljs-title">onCreateView</span><span class="hljs-params">(@NonNull LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">super</span>.onCreateView(inflater, container, savedInstanceState);</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">if</span> (rootView == <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">            rootView = inflater.inflate(getLayoutRes(), container, <span class="hljs-keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        initView(rootView);</span><br><span class="line">        <span class="hljs-keyword">return</span> rootView;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUserVisibleHint</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> isVisibleToUser)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">super</span>.setUserVisibleHint(isVisibleToUser);</span><br><span class="line">        <span class="hljs-comment">// 对于默认 tab 和 间隔 checked tab 需要等到 isViewCreated = true 后才可以通过此通知用户可见</span></span><br><span class="line">        <span class="hljs-comment">// 这种情况下第一次可见不是在这里通知 因为 isViewCreated = false 成立,等从别的界面回到这里后会使用 onFragmentResume 通知可见</span></span><br><span class="line">        <span class="hljs-comment">// 对于非默认 tab mIsFirstVisible = true 会一直保持到选择则这个 tab 的时候，因为在 onActivityCreated 会返回 false</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (isViewCreated) &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (isVisibleToUser &amp;&amp; !currentVisibleState) &#123;</span><br><span class="line">                dispatchUserVisibleHint(<span class="hljs-keyword">true</span>);</span><br><span class="line">            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!isVisibleToUser &amp;&amp; currentVisibleState) &#123;</span><br><span class="line">                dispatchUserVisibleHint(<span class="hljs-keyword">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onActivityCreated</span><span class="hljs-params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">super</span>.onActivityCreated(savedInstanceState);</span><br><span class="line"></span><br><span class="line">        isViewCreated = <span class="hljs-keyword">true</span>;</span><br><span class="line">        <span class="hljs-comment">// !isHidden() 默认为 true  在调用 hide show 的时候可以使用</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (!isHidden() &amp;&amp; getUserVisibleHint()) &#123;</span><br><span class="line">            dispatchUserVisibleHint(<span class="hljs-keyword">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onHiddenChanged</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> hidden)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">super</span>.onHiddenChanged(hidden);</span><br><span class="line">        LogUtils.e(getClass().getSimpleName() + <span class="hljs-string">"  onHiddenChanged dispatchChildVisibleState  hidden "</span> + hidden);</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">if</span> (hidden) &#123;</span><br><span class="line">            dispatchUserVisibleHint(<span class="hljs-keyword">false</span>);</span><br><span class="line">        &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            dispatchUserVisibleHint(<span class="hljs-keyword">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onResume</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">super</span>.onResume();</span><br><span class="line">        <span class="hljs-keyword">if</span> (!mIsFirstVisible) &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (!isHidden() &amp;&amp; !currentVisibleState &amp;&amp; getUserVisibleHint()) &#123;</span><br><span class="line">                dispatchUserVisibleHint(<span class="hljs-keyword">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onPause</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">super</span>.onPause();</span><br><span class="line">        <span class="hljs-comment">// 当前 Fragment 包含子 Fragment 的时候 dispatchUserVisibleHint 内部本身就会通知子 Fragment 不可见</span></span><br><span class="line">        <span class="hljs-comment">// 子 fragment 走到这里的时候自身又会调用一遍 ？</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (currentVisibleState &amp;&amp; getUserVisibleHint()) &#123;</span><br><span class="line">            dispatchUserVisibleHint(<span class="hljs-keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 统一处理 显示隐藏</span></span><br><span class="line"><span class="hljs-comment">     *</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> visible</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">dispatchUserVisibleHint</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> visible)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-comment">//当前 Fragment 是 child 时候 作为缓存 Fragment 的子 fragment getUserVisibleHint = true</span></span><br><span class="line">        <span class="hljs-comment">//但当父 fragment 不可见所以 currentVisibleState = false 直接 return 掉</span></span><br><span class="line">        <span class="hljs-comment">// 这里限制则可以限制多层嵌套的时候子 Fragment 的分发</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (visible &amp;&amp; isParentInvisible()) <span class="hljs-keyword">return</span>;</span><br><span class="line"></span><br><span class="line">       <span class="hljs-comment">//此处是对子 Fragment 不可见的限制，因为 子 Fragment 先于父 Fragment回调本方法 currentVisibleState 置位 false</span></span><br><span class="line">       <span class="hljs-comment">// 当父 dispatchChildVisibleState 的时候第二次回调本方法 visible = false 所以此处 visible 将直接返回</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (currentVisibleState == visible) &#123;</span><br><span class="line">            <span class="hljs-keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        currentVisibleState = visible;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">if</span> (visible) &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (mIsFirstVisible) &#123;</span><br><span class="line">                mIsFirstVisible = <span class="hljs-keyword">false</span>;</span><br><span class="line">                onFragmentFirstVisible();</span><br><span class="line">            &#125;</span><br><span class="line">            onFragmentResume();</span><br><span class="line">            dispatchChildVisibleState(<span class="hljs-keyword">true</span>);</span><br><span class="line">        &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            dispatchChildVisibleState(<span class="hljs-keyword">false</span>);</span><br><span class="line">            onFragmentPause();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 用于分发可见时间的时候父获取 fragment 是否隐藏</span></span><br><span class="line"><span class="hljs-comment">     *</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> true fragment 不可见， false 父 fragment 可见</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isParentInvisible</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        Fragment parentFragment = getParentFragment();</span><br><span class="line">        <span class="hljs-keyword">if</span> (parentFragment <span class="hljs-keyword">instanceof</span> LazyLoadBaseFragment ) &#123;</span><br><span class="line">            LazyLoadBaseFragment fragment = (LazyLoadBaseFragment) parentFragment;</span><br><span class="line">            <span class="hljs-keyword">return</span> !fragment.isSupportVisible();</span><br><span class="line">        &#125;<span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isSupportVisible</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> currentVisibleState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 当前 Fragment 是 child 时候 作为缓存 Fragment 的子 fragment 的唯一或者嵌套 VP 的第一 fragment 时 getUserVisibleHint = true</span></span><br><span class="line"><span class="hljs-comment">     * 但是由于父 Fragment 还进入可见状态所以自身也是不可见的， 这个方法可以存在是因为庆幸的是 父 fragment 的生命周期回调总是先于子 Fragment</span></span><br><span class="line"><span class="hljs-comment">     * 所以在父 fragment 设置完成当前不可见状态后，需要通知子 Fragment 我不可见，你也不可见，</span></span><br><span class="line"><span class="hljs-comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="hljs-comment">     * 因为 dispatchUserVisibleHint 中判断了 isParentInvisible 所以当 子 fragment 走到了 onActivityCreated 的时候直接 return 掉了</span></span><br><span class="line"><span class="hljs-comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="hljs-comment">     * 当真正的外部 Fragment 可见的时候，走 setVisibleHint (VP 中)或者 onActivityCreated (hide show) 的时候</span></span><br><span class="line"><span class="hljs-comment">     * 从对应的生命周期入口调用 dispatchChildVisibleState 通知子 Fragment 可见状态</span></span><br><span class="line"><span class="hljs-comment">     *</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> visible</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">dispatchChildVisibleState</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> visible)</span> </span>&#123;</span><br><span class="line">        FragmentManager childFragmentManager = getChildFragmentManager();</span><br><span class="line">        List&lt;Fragment&gt; fragments = childFragmentManager.getFragments();</span><br><span class="line">        <span class="hljs-keyword">if</span> (!fragments.isEmpty()) &#123;</span><br><span class="line">            <span class="hljs-keyword">for</span> (Fragment child : fragments) &#123;</span><br><span class="line">                <span class="hljs-keyword">if</span> (child <span class="hljs-keyword">instanceof</span> LazyLoadBaseFragment &amp;&amp; !child.isHidden() &amp;&amp; child.getUserVisibleHint()) &#123;</span><br><span class="line">                    ((LazyLoadBaseFragment) child).dispatchUserVisibleHint(visible);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onFragmentFirstVisible</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        LogUtils.e(getClass().getSimpleName() + <span class="hljs-string">"  对用户第一次可见"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onFragmentResume</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        LogUtils.e(getClass().getSimpleName() + <span class="hljs-string">"  对用户可见"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onFragmentPause</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        LogUtils.e(getClass().getSimpleName() + <span class="hljs-string">"  对用户不可见"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onDestroyView</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">super</span>.onDestroyView();</span><br><span class="line">        isViewCreated = <span class="hljs-keyword">false</span>;</span><br><span class="line">        mIsFirstVisible = <span class="hljs-keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 返回布局 resId</span></span><br><span class="line"><span class="hljs-comment">     *</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> layoutId</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getLayoutRes</span><span class="hljs-params">()</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * 初始化view</span></span><br><span class="line"><span class="hljs-comment">     *</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> rootView</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initView</span><span class="hljs-params">(View rootView)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>对于可见状态的生命周期调用顺序，父 Fragment总是优先于子 Fragment，而对于不可见事件，内部的 Fragment 生命周期总是先于外层 Fragment。</strong></p>

        </div>
        
        
        
    </div>
</div>





    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-09-26T07:27:38.000Z">2018-09-26</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Android/">Android</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    7 分钟 读完 (大约 1001 个字)
                </span>
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/09/26/Android-命名规范/">Android 命名规范</a>
            
        </h1>
        <div class="content">
            <h1 id="Android-命名规范"><a href="#Android-命名规范" class="headerlink" title="Android 命名规范"></a>Android 命名规范</h1><h2 id="标识符命名法"><a href="#标识符命名法" class="headerlink" title="标识符命名法"></a>标识符命名法</h2><p>标识符命名法最要有四种:</p>
<ol>
<li>驼峰(Camel)命名法:又称小驼峰命名法，除首单词外，其余所有单词的第一个字母大写。</li>
<li>帕斯卡(pascal)命名法:又称大驼峰命名法，所有单词的第一个字母大写</li>
<li>下划线命名法:单词与单词间用下划线做间隔。</li>
<li>匈牙利命名法:广泛应用于微软编程环境中，在以Pascal命名法的变量前附加小写序列说明该变量的类型。 量的取名方式为：<code>&lt;scope_&gt; + &lt;prefix_&gt; + &lt;qualifier&gt;</code> 范围前缀，类型前缀，限定词。</li>
</ol>
<p>尽可能的用最少的字符而又能完整的表达标识符的含义。</p>
<p>英文缩写原则：</p>
<ol>
<li>较短的单词可通过去掉“元音”形成缩写</li>
<li>较长的单词可取单词的头几个字母形成缩写</li>
<li>此外还有一些约定成俗的英文单词缩写</li>
</ol>
<p>下面为常见的英文单词缩写:</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>缩写</th>
</tr>
</thead>
<tbody>
<tr>
<td>icon</td>
<td>ic</td>
</tr>
<tr>
<td>color</td>
<td>cl</td>
</tr>
<tr>
<td>divider</td>
<td>di</td>
</tr>
<tr>
<td>selector</td>
<td>sl</td>
</tr>
<tr>
<td>background</td>
<td>bg</td>
</tr>
<tr>
<td>image</td>
<td>img</td>
</tr>
<tr>
<td>password</td>
<td>pwd</td>
</tr>
<tr>
<td>position</td>
<td>pos</td>
</tr>
<tr>
<td>TextView</td>
<td>tv</td>
</tr>
<tr>
<td>ImageView</td>
<td>iv</td>
</tr>
<tr>
<td>EditText</td>
<td>et</td>
</tr>
</tbody>
</table>
<p><strong>注意：</strong> 单词缩写原则：不要用缩写，除非该缩写是约定俗成的。</p>
<h2 id="命名规范"><a href="#命名规范" class="headerlink" title="命名规范"></a>命名规范</h2><h3 id="包"><a href="#包" class="headerlink" title="包"></a>包</h3><p>采用反域名命名规则，全部使用小写字母。一级包名为com，二级包名为xx（可以是公司或则个人的随便），三级包名根据应用进行命名，四级包名为模块名或层级名。</p>
<table>
<thead>
<tr>
<th>包名</th>
<th>此包中包含</th>
</tr>
</thead>
<tbody>
<tr>
<td>包名.activities</td>
<td>Activity类</td>
</tr>
<tr>
<td>包名.base</td>
<td>自定义基类</td>
</tr>
<tr>
<td>包名.adapter</td>
<td>Adapter类</td>
</tr>
<tr>
<td>包名.tools</td>
<td>公共工具方法类</td>
</tr>
<tr>
<td>包名.bean</td>
<td>包中包含：实体类</td>
</tr>
<tr>
<td>包名.view (或 widget)</td>
<td>自定义的View类等</td>
</tr>
<tr>
<td>包名.service</td>
<td>Service服务</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
<h3 id="类"><a href="#类" class="headerlink" title="类"></a>类</h3><p>采用大驼峰命名法，尽量避免缩写，除非该缩写是众所周知的，比如 HTML , URL，如果类名称中包含单词缩写，则单词缩写的每个字母均应大写。</p>
<table>
<thead>
<tr>
<th>类</th>
<th>描述</th>
<th>例如</th>
</tr>
</thead>
<tbody>
<tr>
<td>activity</td>
<td>Aty或者Activity为后缀标识</td>
<td>WelcomeAty.或者WelcomeActivity</td>
</tr>
<tr>
<td>Adapter</td>
<td>Adapte 为后缀标识</td>
<td>NewsAdp或NewsAdapter</td>
</tr>
<tr>
<td>基础类</td>
<td>以Base开头</td>
<td>BaseActivity,BaseFragment</td>
</tr>
<tr>
<td>公共方法类</td>
<td>Tools或Manager为后缀标识</td>
<td>ThreadPoolManager, LogTools</td>
</tr>
<tr>
<td>Service</td>
<td>以Service为后缀标识</td>
<td>TimeService</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
<h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><p>动词或动名词，采用小驼峰命名法例如: onCreate(), run()</p>
<h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p>采用小驼峰命名法。类中控件名称必须与xml布局id保持一致。</p>
<p>用统一的量词通过在结尾处放置一个量词，就可创建更加统一的变量，它们更容易理解，也更容易搜索。例如，请使用 <code>strCustomerFirst</code>  和 <code>strCustomerLast</code> ，而不要使用 <code>strFirstCustomer</code> 和 <code>strLastCustomer</code>。</p>
<h3 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h3><p>全部大写,采用下划线命名法.例如：MIN_WIDTH</p>
<h3 id="资源文件"><a href="#资源文件" class="headerlink" title="资源文件"></a>资源文件</h3><p>全部小写，采用下划线命名法，加前缀区分</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>btn_xx</code></td>
<td>按钮图片使用btn_整体效果（selector）</td>
</tr>
<tr>
<td><code>btn_xx_normal</code></td>
<td>按钮图片使用btn_正常情况效果</td>
</tr>
<tr>
<td><code>btn_xx_press</code></td>
<td>按钮图片使用btn_点击时候效果</td>
</tr>
<tr>
<td><code>bg_head</code></td>
<td>背景图片使用bg_功能_说明</td>
</tr>
<tr>
<td><code>ic_more_help</code></td>
<td>图标图片使用icon_功能_说明</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
<h3 id="资源ID"><a href="#资源ID" class="headerlink" title="资源ID"></a>资源ID</h3><p>大小写规范与方法名一致，采用小驼峰命名法。命名规范为“资源控件的缩写  名”+“变量名”。注意：页面控件名称应该和控件id名保持一致</p>
<h3 id="layout中的id命名"><a href="#layout中的id命名" class="headerlink" title="layout中的id命名"></a>layout中的id命名</h3><p>命名模式为：view缩写_模块名称_view的逻辑名称</p>
<table>
<thead>
<tr>
<th>控件</th>
<th>缩写</th>
</tr>
</thead>
<tbody>
<tr>
<td>RelativeView</td>
<td>rv</td>
</tr>
<tr>
<td>TextView</td>
<td>tv</td>
</tr>
<tr>
<td>Button</td>
<td>btn</td>
</tr>
<tr>
<td>ImageView</td>
<td>iv</td>
</tr>
<tr>
<td>ProgressBar</td>
<td>pb</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
<p><strong>注意：</strong> 如果layout文件很复杂，建议将layout分成多个模块，每个模块定义一个moduleViewHolder，其成员变量包含所属view</p>
<h3 id="styles-xml"><a href="#styles-xml" class="headerlink" title="styles.xml"></a>styles.xml</h3><p>将layout中不断重现的style提炼出通用的style通用组件，放到styles.xml中</p>

        </div>
        
        
        
    </div>
</div>





    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-05-21T01:32:39.000Z">2018-05-21</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Android/">Android</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    7 分钟 读完 (大约 978 个字)
                </span>
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/05/21/Android-动态权限申请/">Android 动态权限申请</a>
            
        </h1>
        <div class="content">
            <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p><img src="http://upload-images.jianshu.io/upload_images/3985563-80387c4edc364fb5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="权限列表"></p>
<p>Android6.0以上把权限分为普通权限和危险权限，所以危险权限是需要动态申请，给予用户提示的。</p>
<p>看到上面的 permissions，会发现一个问题，危险权限都是一组一组的。</p>
<p>分组对权限机制的申请是有一定影响的。例如app运行在android 6.x的机器上，对于授权机制是这样的。如果你申请某个危险的权限，假设你的app早已被用户授权了同一组的某个危险权限，那么系统会立即授权，而不需要用户去点击授权。比如你的app对 <code>READ_CONTACTS</code> 已经授权了，当你的app申请 <code>WRITE_CONTACTS</code> 时，系统会直接授权通过。</p>
<p>此外，对于申请时的弹窗上面的文本说明也是对整个权限组的说明，而不是单个权限。</p>
<h1 id="动态权限申请"><a href="#动态权限申请" class="headerlink" title="动态权限申请"></a>动态权限申请</h1><p><strong>1.首先要保证在AndroidManifest中写明需要的权限。</strong><br><figure class="highlight xml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.READ_CONTACTS"</span> /&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.WRITE_CONTACTS"</span> /&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.CAMERA"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>2.权限申请示例 以获取定位权限为例。</strong></p>
<ol>
<li>点击按钮，检查并申请权限<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">btn.setOnClickListener(<span class="hljs-keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="hljs-meta">@Override</span></span><br><span class="line">            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span><span class="hljs-params">(View view)</span> </span>&#123;</span><br><span class="line">                <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;<span class="hljs-number">23</span>) &#123;</span><br><span class="line">                    <span class="hljs-keyword">if</span> (ContextCompat.checkSelfPermission(MainActivity.<span class="hljs-keyword">this</span>,</span><br><span class="line">                             Manifest.permission.ACCESS_COARSE_LOCATION)</span><br><span class="line">                            == PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line">                        <span class="hljs-comment">//授予权限</span></span><br><span class="line">                        getLoation();</span><br><span class="line">                    &#125;<span class="hljs-keyword">else</span>&#123;</span><br><span class="line">                        <span class="hljs-comment">//未获得权限</span></span><br><span class="line">                        requestPermissions(<span class="hljs-keyword">new</span> String[]&#123;Manifest.permission.ACCESS_COARSE_LOCATION&#125;</span><br><span class="line">                                ,REQUEST_CODE_LOCATION);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>如果有权限，执行获取位置逻辑，如果没权限，则进行请求权限。</p>
<ol start="2">
<li>权限申请结果回调<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Override</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onRequestPermissionsResult</span><span class="hljs-params">(<span class="hljs-keyword">int</span> requestCode, @NonNull String[] permissions, @NonNull <span class="hljs-keyword">int</span>[] grantResults)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (requestCode == REQUEST_CODE_LOCATION)&#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (grantResults[<span class="hljs-number">0</span>] == PackageManager.PERMISSION_GRANTED)&#123;</span><br><span class="line">            getLoation();</span><br><span class="line">        &#125; <span class="hljs-keyword">else</span>&#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (shouldShowRequestPermissionRationale( Manifest.permission.ACCESS_COARSE_LOCATION))&#123;</span><br><span class="line">                <span class="hljs-keyword">new</span> AlertDialog.Builder(<span class="hljs-keyword">this</span>)</span><br><span class="line">                        .setMessage(<span class="hljs-string">"申请定位权限,才能为你推送更准确的信息"</span>)</span><br><span class="line">                        .setPositiveButton(<span class="hljs-string">"确定"</span>, <span class="hljs-keyword">new</span> DialogInterface.OnClickListener() &#123;</span><br><span class="line">                            <span class="hljs-meta">@Override</span></span><br><span class="line">                            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span><span class="hljs-params">(DialogInterface dialog, <span class="hljs-keyword">int</span> which)</span> </span>&#123;</span><br><span class="line">                                <span class="hljs-comment">//申请定位权限</span></span><br><span class="line">                                requestPermissions(MainActivity.<span class="hljs-keyword">this</span>,</span><br><span class="line">                                        <span class="hljs-keyword">new</span> String[]&#123;Manifest.permission.ACCESS_COARSE_LOCATION&#125;, REQUEST_CODE_LOCATION);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">super</span>.onRequestPermissionsResult(requestCode, permissions, grantResults);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>如果同意，执行获取位置逻辑，如果拒绝，重写 <code>shouldShowRequestPermissionRationale</code> 方法，返回 true,向用户弹窗给出一个获取权限的提示，点击后再次申请权限。</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">shouldShowRequestPermissionRationale</span><span class="hljs-params">(@NonNull String permission)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (permission.equals(Manifest.permission.ACCESS_COARSE_LOCATION) ) &#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.shouldShowRequestPermissionRationale(permission);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重写shouldShowRequestPermissionRationale，在申请位置权限时，返回true，给用户解释。</p>
<p>完整代码<br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PermissionActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AppCompatActivity</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">View</span>.<span class="hljs-title">OnClickListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String TAG = <span class="hljs-string">"PermissionActivity"</span>;</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> REQUEST_CAMERA = <span class="hljs-number">1</span>;</span><br><span class="line">    <span class="hljs-keyword">private</span> ConstraintLayout constraintLayout;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_permission);</span><br><span class="line"></span><br><span class="line">        initView();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initView</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        constraintLayout = findViewById(R.id.mainLayout);</span><br><span class="line">        findViewById(R.id.btn_camera).setOnClickListener(<span class="hljs-keyword">this</span>);</span><br><span class="line">        findViewById(R.id.btn_contact).setOnClickListener(<span class="hljs-keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@RequiresApi</span>(api = Build.VERSION_CODES.M)</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">checkPermission</span><span class="hljs-params">(String permission)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">int</span> i = checkSelfPermission(permission);</span><br><span class="line">        <span class="hljs-keyword">return</span> i != PackageManager.PERMISSION_DENIED;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">showSnackbar</span><span class="hljs-params">(String message)</span> </span>&#123;</span><br><span class="line">        Snackbar.make(constraintLayout, message, Snackbar.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span><span class="hljs-params">(View v)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">switch</span> (v.getId()) &#123;</span><br><span class="line">            <span class="hljs-keyword">case</span> R.id.btn_camera:</span><br><span class="line">                showCamera();</span><br><span class="line">                <span class="hljs-keyword">break</span>;</span><br><span class="line">            <span class="hljs-keyword">case</span> R.id.btn_contact:</span><br><span class="line">                <span class="hljs-keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">showCamera</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M) &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (checkPermission(Manifest.permission.CAMERA)) &#123;</span><br><span class="line">                showSnackbar(<span class="hljs-string">"已授权，可以打开"</span>);</span><br><span class="line">            &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">                <span class="hljs-keyword">if</span> (shouldShowRequestPermissionRationale(Manifest.permission.CAMERA)) &#123;</span><br><span class="line">                    Snackbar.make(constraintLayout, <span class="hljs-string">"Camera permission is needed"</span>, Snackbar.LENGTH_SHORT)</span><br><span class="line">                            .setAction(<span class="hljs-string">"确定"</span>, <span class="hljs-keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">                                <span class="hljs-meta">@Override</span></span><br><span class="line">                                <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span><span class="hljs-params">(View v)</span> </span>&#123;</span><br><span class="line">                                    requestPermissions(<span class="hljs-keyword">new</span> String[]&#123;Manifest.permission.CAMERA&#125;, REQUEST_CAMERA);</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;).show();</span><br><span class="line">                &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">                    requestPermissions(<span class="hljs-keyword">new</span> String[]&#123;Manifest.permission.CAMERA&#125;, REQUEST_CAMERA);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            showSnackbar(<span class="hljs-string">"可以直接打开"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onRequestPermissionsResult</span><span class="hljs-params">(<span class="hljs-keyword">int</span> requestCode, @NonNull String[] permissions, @NonNull <span class="hljs-keyword">int</span>[] grantResults)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">switch</span> (requestCode) &#123;</span><br><span class="line">            <span class="hljs-keyword">case</span> REQUEST_CAMERA:</span><br><span class="line">                <span class="hljs-keyword">if</span> (grantResults.length &gt; <span class="hljs-number">0</span>) &#123;</span><br><span class="line">                    <span class="hljs-keyword">if</span> (grantResults[<span class="hljs-number">0</span>] == PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line">                        showSnackbar(<span class="hljs-string">"已授权"</span>);</span><br><span class="line">                    &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">                        showSnackbar(<span class="hljs-string">"拒绝授权"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="hljs-keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">super</span>.onRequestPermissionsResult(requestCode, permissions, grantResults);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>另外，在看一些 权限申请 的三方库的时候，发现了一件很有意思的事情。通常代码很难追踪到 Activity 的生命周期，一些库就新建一个 Fragment 在其生命周期的各个回调方法里去调用相应的方法。很棒。</p>
<p><strong>参考文章</strong></p>
<ul>
<li><a href="https://github.com/googlesamples/android-RuntimePermissions" target="_blank" rel="noopener">Google官方实例</a></li>
<li><a href="http://lruheng.com/2017/07/29/Android%E6%9D%83%E9%99%90%E5%A4%84%E7%90%86%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B/" target="_blank" rel="noopener">Android权限处理的那些事</a></li>
<li><a href="https://github.com/tbruyelle/RxPermissions" target="_blank" rel="noopener">RxPermissions</a></li>
<li><a href="https://github.com/yanzhenjie/AndPermission" target="_blank" rel="noopener">AndPermission</a></li>
</ul>

        </div>
        
        
        
    </div>
</div>





    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-05-08T12:51:33.000Z">2018-05-08</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Android/">Android</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    13 分钟 读完 (大约 1887 个字)
                </span>
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/05/08/Lottie-详解/">Lottie 详解</a>
            
        </h1>
        <div class="content">
            <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>Lottie 是 Airbnb 开源的一个面向 iOS、Android、React Native 的动画库，能分析 Adobe After Effects 导出的动画，并且能让原生 App 像使用静态素材一样使用这些动画，完美实现动画效果。</p>
<p>现在使用各平台的 native 代码实现一套复杂的动画是一件很困难并且耗时的事，我们需要为不同尺寸的屏幕加载不同的素材资源，还需要写大量难维护的代码，而 Lottie 可以做到同一个动画文件在不同平台上实现相同的效果，极大减少开发时间，实现不同的动画，只需要设置不同的动画文件即可，极大减少开发和维护成本。</p>
<p>官方效果图：</p>
<p><img src="http://o797mwhn1.bkt.clouddn.com/lottie_intro.gif" alt="官方效果图"></p>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><p>Lottie 支持多平台，使用同一个 JSON 动画文件，可在不同平台实现相同的效果。其中，Android 通过 Airbnb 的开源项目 lottie-android 实现，最低支持 API 16。</p>
<h2 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h2><p><code>implementation &#39;com.airbnb.android:lottie:2.5.4&#39;</code></p>
<h2 id="添加-Adobe-After-Effects-导出的动画文件"><a href="#添加-Adobe-After-Effects-导出的动画文件" class="headerlink" title="添加 Adobe After Effects 导出的动画文件"></a>添加 Adobe After Effects 导出的动画文件</h2><p>Lottie 默认读取 Assets 中的文件，我们需要把动画文件 react.json 保存在 <code>app/src/main/assets</code> 文件里。在 <a href="https://www.lottiefiles.com/popular" target="_blank" rel="noopener">官网</a> 可以免费下载动画文件。</p>
<figure class="highlight hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">// react.json</span><br><span class="line">&#123;</span><br><span class="line">    <span class="hljs-attr">"v"</span>: <span class="hljs-string">"4.6.0"</span>,</span><br><span class="line">    <span class="hljs-attr">"fr"</span>: <span class="hljs-number">29.9700012207031</span>,</span><br><span class="line">    <span class="hljs-attr">"ip"</span>: <span class="hljs-number">0</span>,</span><br><span class="line">    <span class="hljs-attr">"op"</span>: <span class="hljs-number">141.000005743048</span>,</span><br><span class="line">    <span class="hljs-attr">"w"</span>: <span class="hljs-number">800</span>,</span><br><span class="line">    <span class="hljs-attr">"h"</span>: <span class="hljs-number">800</span>,</span><br><span class="line">    <span class="hljs-attr">"ddd"</span>: <span class="hljs-number">0</span>,</span><br><span class="line">    <span class="hljs-attr">"assets"</span>: [ ],</span><br><span class="line">    <span class="hljs-attr">"layers"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="hljs-attr">"ddd"</span>: <span class="hljs-number">0</span>,</span><br><span class="line">            <span class="hljs-attr">"ind"</span>: <span class="hljs-number">0</span>,</span><br><span class="line">            <span class="hljs-attr">"ty"</span>: <span class="hljs-number">4</span>,</span><br><span class="line">            <span class="hljs-attr">"nm"</span>: <span class="hljs-string">"center_circle"</span>,</span><br><span class="line">            "ks": &#123;...&#125;,</span><br><span class="line">            "ao": 0,</span><br><span class="line">            "shapes": [...],</span><br><span class="line">            "ip": 0,</span><br><span class="line">            "op": 900.000036657751,</span><br><span class="line">            "st": 0,</span><br><span class="line">            "bm": 0,</span><br><span class="line">            "sr": 1</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;...&#125;,</span><br><span class="line">        &#123;...&#125;,</span><br><span class="line">        &#123;...&#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="使用Lottie"><a href="#使用Lottie" class="headerlink" title="使用Lottie"></a>使用Lottie</h2><p>在布局文件中直接添加 Lottie 的 LottieAnimationView 控件，即可在界面显示 React logo 动画效果</p>
<figure class="highlight xml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">com.airbnb.lottie.LottieAnimationView</span></span></span><br><span class="line"><span class="hljs-tag">    <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/animation_view"</span></span></span><br><span class="line"><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"wrap_content"</span></span></span><br><span class="line"><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span></span></span><br><span class="line"><span class="hljs-tag">    <span class="hljs-attr">app:lottie_fileName</span>=<span class="hljs-string">"react.json"</span></span></span><br><span class="line"><span class="hljs-tag">    <span class="hljs-attr">app:lottie_loop</span>=<span class="hljs-string">"true"</span></span></span><br><span class="line"><span class="hljs-tag">    <span class="hljs-attr">app:lottie_autoPlay</span>=<span class="hljs-string">"true"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>属性说明：</strong></p>
<ul>
<li><code>app:lottie_fileName</code>: assets 文件夹下对应的动画文件的文件名</li>
<li><code>app:lottie_loop</code>: 是否循环播放动画</li>
<li><code>app:lottie_autoPlay</code>: 是否自动播放动画</li>
<li><code>app:lottie_cacheStrategy</code>: 设置缓存策略。默认为none，可选值有strong和weak</li>
<li><code>app:lottie_colorFilter</code>: 设置背景颜色</li>
<li><code>app:lottie_progress</code>: 设置动画播放进度</li>
<li><code>app:lottie_imageAssetsFolder</code>: 动画所需图片资源在assets中的绝对路径。如果没有图片资源，可以省略</li>
</ul>
<p><strong>代码使用:</strong></p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">LottieAnimationView animationView = (LottieAnimationView) findViewById(R.id.animation_view);</span><br><span class="line"></span><br><span class="line">animationView.playAnimation(); <span class="hljs-comment">//播放动画</span></span><br><span class="line"></span><br><span class="line">animationView.setAnimation(<span class="hljs-string">"data1.json"</span>, CacheStrategy.Strong); <span class="hljs-comment">// 设置动画文件以及缓存策略</span></span><br><span class="line"></span><br><span class="line">PorterDuffColorFilter colorFilter = <span class="hljs-keyword">new</span> PorterDuffColorFilter(ContextCompat.getColor(<span class="hljs-keyword">this</span>,android.R.color.holo_blue_light), PorterDuff.Mode.ADD);</span><br><span class="line">animationView.addColorFilter(colorFilter); <span class="hljs-comment">// 设置背景颜色</span></span><br><span class="line"></span><br><span class="line">animationView.loop(<span class="hljs-keyword">true</span>); <span class="hljs-comment">// 循环播放</span></span><br><span class="line"></span><br><span class="line">animationView.setProgress(<span class="hljs-number">0.5f</span>); <span class="hljs-comment">// 设置动画播放进度。需要注意值是float型。</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 监听动画的状态</span></span><br><span class="line">animationView.addAnimatorListener(<span class="hljs-keyword">new</span> Animator.AnimatorListener() &#123;</span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAnimationStart</span><span class="hljs-params">(Animator animation)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-comment">// 开始</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAnimationEnd</span><span class="hljs-params">(Animator animation)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-comment">// 结束</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAnimationCancel</span><span class="hljs-params">(Animator animation)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-comment">// 取消</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAnimationRepeat</span><span class="hljs-params">(Animator animation)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-comment">// 重复</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 动态监听动画演示过程，可以动态获取动画进度</span></span><br><span class="line">animationView.addAnimatorUpdateListener(<span class="hljs-keyword">new</span> AnimatorUpdateListener() &#123;</span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAnimationUpdate</span><span class="hljs-params">(ValueAnimator animation)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">animationView.pauseAnimation(); <span class="hljs-comment">// 暂停动画</span></span><br><span class="line"></span><br><span class="line">animationView.isAnimating() <span class="hljs-comment">// 是否正在播放动画</span></span><br><span class="line"></span><br><span class="line">animationView.resumeAnimation() <span class="hljs-comment">// 恢复动画</span></span><br><span class="line"></span><br><span class="line">animationView.cancelAnimation() <span class="hljs-comment">// 取消动画</span></span><br></pre></td></tr></table></figure>
<h2 id="使用小技巧"><a href="#使用小技巧" class="headerlink" title="使用小技巧"></a>使用小技巧</h2><h3 id="加载SDCard动画文件"><a href="#加载SDCard动画文件" class="headerlink" title="加载SDCard动画文件"></a>加载SDCard动画文件</h3><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">StringBuilder stringBuilder = <span class="hljs-keyword">new</span> StringBuilder();</span><br><span class="line">BufferedReader bufferedReader = <span class="hljs-keyword">new</span> BufferedReader(<span class="hljs-keyword">new</span> FileReader(<span class="hljs-keyword">new</span> File(JSON_PATH + <span class="hljs-string">"react.json"</span>)));</span><br><span class="line">String content = <span class="hljs-keyword">null</span>;</span><br><span class="line"><span class="hljs-keyword">while</span> ((content = bufferedReader.readLine()) != <span class="hljs-keyword">null</span>)&#123;</span><br><span class="line">    stringBuilder.append(content);</span><br><span class="line">&#125;</span><br><span class="line">JSONObject jsonObject = <span class="hljs-keyword">new</span> JSONObject(stringBuilder.toString());</span><br><span class="line">animationView.setAnimation(jsonObject);</span><br><span class="line">animationView.loop(<span class="hljs-keyword">true</span>);</span><br><span class="line">animationView.playAnimation();</span><br></pre></td></tr></table></figure>
<h3 id="加载SDCard图片"><a href="#加载SDCard图片" class="headerlink" title="加载SDCard图片"></a>加载SDCard图片</h3><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">animationView.setImageAssetDelegate(<span class="hljs-keyword">new</span> ImageAssetDelegate() &#123;</span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> Bitmap <span class="hljs-title">fetchBitmap</span><span class="hljs-params">(LottieImageAsset asset)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">            FileInputStream fileInputStream = <span class="hljs-keyword">new</span> FileInputStream(IMAGE_PATH + asset.getFileName());</span><br><span class="line">            <span class="hljs-keyword">return</span> BitmapFactory.decodeStream(fileInputStream);  <span class="hljs-comment">///把流转化为Bitmap图片</span></span><br><span class="line">        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="加载SDCard字体"><a href="#加载SDCard字体" class="headerlink" title="加载SDCard字体"></a>加载SDCard字体</h3><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">animationView.setFontAssetDelegate(<span class="hljs-keyword">new</span> FontAssetDelegate()&#123;</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> Typeface <span class="hljs-title">fetchFont</span><span class="hljs-params">(String fontFamily)</span> </span>&#123;</span><br><span class="line">        Typeface customFont = Typeface.createFromFile(FONT_PATH + fontFamily);</span><br><span class="line">        <span class="hljs-keyword">return</span> customFont;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="缓存动画"><a href="#缓存动画" class="headerlink" title="缓存动画"></a>缓存动画</h3><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> *Lottie内部有两个缓存map（强引用缓存，弱引用缓存），在动画文件加载完成后会根据设置的缓存策略缓存动画，方便下次使用。</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line">animationView.setAnimation(animation, LottieAnimationView.CacheStrategy.Strong);    <span class="hljs-comment">//强缓存</span></span><br><span class="line">animationView.setAnimation(animation, LottieAnimationView.CacheStrategy.Weak);      <span class="hljs-comment">//弱缓存</span></span><br></pre></td></tr></table></figure>
<h1 id="Lottie实现原理"><a href="#Lottie实现原理" class="headerlink" title="Lottie实现原理"></a>Lottie实现原理</h1><p>Lottie 的使用的资源是需要先通过 bodymovin( bodymovin 插件本身是用于网页上呈现各种AE效果的一个开源库) 将 Adobe After Effects (AE) 生成的aep动画工程文件转换为通用的json格式描述文件。Lottie则负责解析动画的数据，计算每个动画在某个时间点的状态，准确地绘制到屏幕上。</p>
<p>Lottie 对外通过控件 LottieAnimationView 暴露接口，控制动画。<br>LottieAnimationView 继承自 ImageView，通过当前时间绘制 canvas 显示到界面上。这里有两个关键类：LottieComposition 负责解析json描述文件，把json内容转成Java数据对象；LottieDrawable负责绘制，把LottieComposition转成的数据对象绘制成drawable显示到View上。顺序如下：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/6GYDCe0a26ibjkHUZlJZHpCUQ4Cibj6oCKVViaibdGgicluU6AI9bYtKnn1IpOtMYxeA3HUFwb6jZHOsyEd5pLFMsCA/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt="顺序"></p>
<p>探究更多原理解析内容请在 <a href="https://mp.weixin.qq.com/s/LrkZtDZY3SE8IUQ-x1hsmQ" target="_blank" rel="noopener">Lottie–让动画如此简单</a> 查看。</p>
<h1 id="性能"><a href="#性能" class="headerlink" title="性能"></a>性能</h1><p>内容来自 腾讯音乐技术团队 。</p>
<h2 id="官方说明"><a href="#官方说明" class="headerlink" title="官方说明"></a>官方说明</h2><ul>
<li>如果没有 mask 和 mattes，那么性能和内存非常好，没有 bitmap 创建，大部分操作都是简单的 cavas 绘制。</li>
<li>如果存在 mattes，将会创建2～3个 bitmap。bitmap 在动画加载到 window 时被创建，被 window 删除时回收。所以不宜在 RecyclerView 中使用包涵 mattes 或者 mask 的动画，否则会引起 bitmap 抖动。除了内存抖动，mattes和mask中必要的 bitmap.eraseColor() 和 canvas.drawBitmap() 也会降低动画性能。对于简单的动画，在实际使用时性能不太明显。</li>
<li>如果在列表中使用动画，推荐使用缓存 <code>LottieAnimationView.setAnimation(String, CacheStrategy)</code> 。</li>
</ul>
<h2 id="属性动画和Lottie动画对比"><a href="#属性动画和Lottie动画对比" class="headerlink" title="属性动画和Lottie动画对比"></a>属性动画和Lottie动画对比</h2><p>以下性能对比是以K歌内单个礼物动画效果</p>
<table>
<thead>
<tr>
<th>-</th>
<th>属性动画</th>
<th>lottie使用硬件加速</th>
<th>lottie未使用硬件加速</th>
</tr>
</thead>
<tbody>
<tr>
<td>帧率</td>
<td><img src="https://mmbiz.qpic.cn/mmbiz_jpg/6GYDCe0a26ibjkHUZlJZHpCUQ4Cibj6oCKqiarh4eITib6uwiatVQaNfVweOw718rVlZvvUpBG95tGNHDoFjGgWIkPg/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt=""></td>
<td><img src="https://mmbiz.qpic.cn/mmbiz_jpg/6GYDCe0a26ibjkHUZlJZHpCUQ4Cibj6oCKq33Z1py8eMsicCMLNu43ric7YQJduoYe7qfgxiamDIbwkaHYW3wmpeibzA/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt=""></td>
<td><img src="https://mmbiz.qpic.cn/mmbiz_jpg/6GYDCe0a26ibjkHUZlJZHpCUQ4Cibj6oCKNkbbUqcKkCyt0DDPMBh3ZH3iadzoNIJvAmTfpyXjx1jNEDQEjuT4ddQ/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt=""></td>
</tr>
<tr>
<td>内存</td>
<td><img src="https://mmbiz.qpic.cn/mmbiz_jpg/6GYDCe0a26ibjkHUZlJZHpCUQ4Cibj6oCKVk16ibr4mM9UVG7UqQTZQ6mz1Z1ETAzO6zcreiaFlJ7RyXA7o6dkCVAw/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt=""></td>
<td><img src="https://mmbiz.qpic.cn/mmbiz_jpg/6GYDCe0a26ibjkHUZlJZHpCUQ4Cibj6oCKzD5U96LDhGdLOa6JWq9E7CyGHpg1URdW4hPhQpsfv10ibDugFHWcDlw/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt=""></td>
<td><img src="https://mmbiz.qpic.cn/mmbiz_jpg/6GYDCe0a26ibjkHUZlJZHpCUQ4Cibj6oCKpn3XOrnTs65wtF9cH75xBtNGW3mJqg66fZZFOu1yb4XBuSDsXVBoyQ/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt=""></td>
</tr>
<tr>
<td>cpu</td>
<td><img src="https://mmbiz.qpic.cn/mmbiz_png/6GYDCe0a26ibjkHUZlJZHpCUQ4Cibj6oCKhJd4RiaicroohE8nukwLliaC4ia6iaqRqFzFGGibTNLf258Rt3AnAvibOW6YQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt=""></td>
<td><img src="https://mmbiz.qpic.cn/mmbiz_png/6GYDCe0a26ibjkHUZlJZHpCUQ4Cibj6oCKaTVzCvZicYKjiay4OmNqj9VDACibWfH1g5FOqT5ibHAfL4Ry1QicNWeApng/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt=""></td>
<td><img src="https://mmbiz.qpic.cn/mmbiz_png/6GYDCe0a26ibjkHUZlJZHpCUQ4Cibj6oCKaU3hrhxWQYCe3Vd5LrVNURxdmfqgmbzfj2jW1v9frUCGO3r9O1wibLQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt=""></td>
</tr>
</tbody>
</table>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>Lottie使用简单，易于上手，非常值得尝试。</p>
<h2 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h2><ul>
<li>开发效率高—代码实现简单，更换动画方便，易于调试和维护。</li>
<li>数据源多样性—可从assets,sdcard,网络加载动画资源，能做到不发版本，动态更新</li>
<li>跨平台—设计稿导出一份动画描述文件，android,ios,react native通用</li>
</ul>
<h2 id="劣势"><a href="#劣势" class="headerlink" title="劣势"></a>劣势</h2><ul>
<li>性能不够好—某些动画特效，内存和性能不够好；</li>
<li>相对于属性动画，在展示大动画时，帧率较低</li>
</ul>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><ul>
<li><a href="https://www.jianshu.com/p/a37b3e4d9ccd" target="_blank" rel="noopener">Android开发之Lottie动画解析库</a></li>
<li><a href="https://mp.weixin.qq.com/s/LrkZtDZY3SE8IUQ-x1hsmQ" target="_blank" rel="noopener">Lottie–让动画如此简单</a></li>
<li><a href="http://airbnb.io/lottie/android/android.html" target="_blank" rel="noopener">Lottie 官网</a></li>
</ul>

        </div>
        
        
        
    </div>
</div>





    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-05-03T12:39:33.000Z">2018-05-03</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Android/">Android</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    4 分钟 读完 (大约 638 个字)
                </span>
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/05/03/RecyclerView-IndexOutOfBoundsException/">RecyclerView IndexOutOfBoundsException</a>
            
        </h1>
        <div class="content">
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近使用 RecyclerView 的 <code>notifyItemInserted</code> 和 <code>notifyItemRemoved</code> 的时候，经常遇到这个异常。</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">java.lang.IndexOutOfBoundsException: Inconsistency detected. Invalid view holder adapter positionViewHolder&#123;<span class="hljs-number">2064e5</span>c6 position=<span class="hljs-number">2</span> id=-<span class="hljs-number">1</span>, oldPos=<span class="hljs-number">2</span>, pLpos:-<span class="hljs-number">1</span> scrap [attachedScrap] tmpDetached no parent&#125;</span><br><span class="line">at android.support.v7.widget.RecyclerView$Recycler.validateViewHolderForOffsetPosition(RecyclerView.java:<span class="hljs-number">4505</span>)</span><br><span class="line">at android.support.v7.widget.RecyclerView$Recycler.getViewForPosition(RecyclerView.java:<span class="hljs-number">4636</span>)</span><br><span class="line">at android.support.v7.widget.RecyclerView$Recycler.getViewForPosition(RecyclerView.java:<span class="hljs-number">4617</span>)</span><br><span class="line">at android.support.v7.widget.LinearLayoutManager$LayoutState.next(LinearLayoutManager.java:<span class="hljs-number">1994</span>)</span><br><span class="line">at android.support.v7.widget.LinearLayoutManager.layoutChunk(LinearLayoutManager.java:<span class="hljs-number">1390</span>)</span><br><span class="line">at android.support.v7.widget.LinearLayoutManager.fill(LinearLayoutManager.java:<span class="hljs-number">1353</span>)</span><br><span class="line">at android.support.v7.widget.LinearLayoutManager.onLayoutChildren(LinearLayoutManager.java:<span class="hljs-number">574</span>)</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>查了一些资料，大多是说因为数据源改变了，但是 adapter 却没有及时调用 <code>notifyItemRangeChanged</code> 。</p>
<h1 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h1><h2 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h2><p>自己写一个继承 LinearLayoutManager 的包装类，在 onLayoutChildren() 方法里 try-catch 捕获该异常。然后给 recyclerView 设置该 LayoutManager<br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WrapContentLinearLayoutManager</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">LinearLayoutManager</span> </span>&#123;</span><br><span class="line">    <span class="hljs-comment">//... constructor</span></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onLayoutChildren</span><span class="hljs-params">(RecyclerView.Recycler recycler, RecyclerView.State state)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">            <span class="hljs-keyword">super</span>.onLayoutChildren(recycler, state);</span><br><span class="line">        &#125; <span class="hljs-keyword">catch</span> (IndexOutOfBoundsException e) &#123;</span><br><span class="line">            Log.e(<span class="hljs-string">"probe"</span>, <span class="hljs-string">"meet a IOOBE in RecyclerView"</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">RecyclerView recyclerView = (RecyclerView)findViewById(R.id.recycler_view);</span><br><span class="line"></span><br><span class="line">recyclerView.setLayoutManager(<span class="hljs-keyword">new</span> WrapContentLinearLayoutManager(activity, LinearLayoutManager.HORIZONTAL, <span class="hljs-keyword">false</span>));</span><br></pre></td></tr></table></figure></p>
<h2 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h2><p>在进行数据移除和数据增加时，务必要保证RecyclerView的Adapter中的数据集和移除／添加等操作后的数据集保持一致！</p>
<p>这里，前者是在该Adapter内部，不妨叫做内部数据集，后者是开发人员传过给Adapter的，不妨叫外部数据集。更新RecyclerView数据时，需要保证外部数据集和内部数据集<strong>实时</strong>保持一致。<strong>每一次对外部数据集做改动时，都需要紧接着主动对外部数据集和内部数据集做一次同步操作</strong></p>
<p>外部数据集同步到内部数据集，使用如下的方法：</p>
<ul>
<li>notifyItemRangeRemoved();</li>
<li>notifyItemRangeInserted();</li>
<li>notifyItemRangeChanged();</li>
<li>notifyDataSetChanged();</li>
</ul>
<p>这里对 notifyDataSetChange() 做些说明：</p>
<p>使用该方法的更新内部数据集，没有默认的动画效果，同时更新数据的效率页不如上面的方法，官方不推荐使用这种方式更新数据集。</p>
<h2 id="方法三"><a href="#方法三" class="headerlink" title="方法三"></a>方法三</h2><p>使用notifyDataSetChanged同步外部数据集和内部数据集。该方法简单，但是失去了动画效果，并且更新数据的性能低。</p>
<p>另外，如果对外部数据集做了二次以上的操作，却只调用notifyDataSetChanged同步一次，也很有可能会报上文所示的错误。</p>
<p><strong>参考文章:</strong></p>
<ul>
<li><a href="https://stackoverflow.com/questions/31759171/recyclerview-and-java-lang-indexoutofboundsexception-inconsistency-detected-in" target="_blank" rel="noopener">stackoverflow</a></li>
<li><a href="https://www.jianshu.com/p/2eca433869e9" target="_blank" rel="noopener">当RecyclerView遇到Inconsistency detected崩溃</a></li>
<li><a href="https://blog.csdn.net/Singleton1900/article/details/48369239" target="_blank" rel="noopener">使用RecyclerView遇到的一些问题 Inconsistency detected</a></li>
</ul>

        </div>
        
        
        
    </div>
</div>





    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-04-26T12:48:03.000Z">2018-04-26</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Android/">Android</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    31 分钟 读完 (大约 4606 个字)
                </span>
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/04/26/Glide-源码解析-一/">Glide 源码解析 一</a>
            
        </h1>
        <div class="content">
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>在众多的图片加载框架中，Glide 是 Google 推荐的，并在自家的项目中大量使用的一个非常强大的框架，专注于平滑滚动，并且还提供 Gif，本地 Vedio 首帧的解码和显示。Glide 提供了非常便捷的链式调用接口，以及丰富的拓展和自定义功能，开发者可以非常简单地对框架进行配置和图片再加工。</p>
<p>如今 Gilde 已经更新到4.x，了解其源码对更好的使用 Glide ，以及学习相关的图片处理技术，学习更优雅的编码会有很大的帮助。</p>
<p>不得不说，Glide 整个框架的极其复杂的，特别是在对资源的转换和解码过程中，涉及了许多的嵌套循环，同时也使用了大量的工厂模式用于生产转换模块，编码模块，解码模块等，笔者在阅读过程中，多次迷失在茫茫的代码流中。</p>
<p>为此，萌生了将对 Glide 的理解记录成文的想法，借以理清思路。</p>
<p>那么接下来，我们就先看看 Glide 是如何进行框架初始化的。</p>
<h1 id="探究"><a href="#探究" class="headerlink" title="探究"></a>探究</h1><h2 id="Glide-with发生了什么？"><a href="#Glide-with发生了什么？" class="headerlink" title="Glide.with发生了什么？"></a>Glide.with发生了什么？</h2><h3 id="1-Glide单例的加载"><a href="#1-Glide单例的加载" class="headerlink" title="1. Glide单例的加载"></a>1. Glide单例的加载</h3><p>使用过 Glide 的都知道，调用 Glide 加载一张图片时，第一句代码便是 Glide.with(this)，这里肯定就是 Glide 的入口了，通过这句代码，Glide 开始了“漫漫的”初始化之路。</p>
<p>Glide 重载了多个 with 的方法，分别用于不同的情境下使用，我们看其中最常用的在 Activity 中调用的方法，即</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@NonNull</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> RequestManager <span class="hljs-title">with</span><span class="hljs-params">(@NonNull Activity activity)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> getRetriever(activity).get(activity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先，跟进 <code>getRetriever(activity)</code></p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@NonNull</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> RequestManagerRetriever <span class="hljs-title">getRetriever</span><span class="hljs-params">(@Nullable Context context)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-comment">// Context could be null for other reasons (ie the user passes in null), but in practice it will</span></span><br><span class="line">    <span class="hljs-comment">// only occur due to errors with the Fragment lifecycle.</span></span><br><span class="line">    Preconditions.checkNotNull(</span><br><span class="line">        context,</span><br><span class="line">        <span class="hljs-string">"You cannot start a load on a not yet attached View or a Fragment where getActivity() "</span></span><br><span class="line">            + <span class="hljs-string">"returns null (which usually occurs when getActivity() is called before the Fragment "</span></span><br><span class="line">            + <span class="hljs-string">"is attached or after the Fragment is destroyed)."</span>);</span><br><span class="line">    <span class="hljs-keyword">return</span> Glide.get(context).getRequestManagerRetriever();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里首先检查了 context 是否为空，如果为 null，抛出异常。</p>
<p>我们重点来看 <code>Glide.get(context)</code></p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@NonNull</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Glide <span class="hljs-title">get</span><span class="hljs-params">(@NonNull Context context)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (glide == <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">        <span class="hljs-keyword">synchronized</span> (Glide.class) &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (glide == <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">                checkAndInitializeGlide(context);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">return</span> glide;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里是一个典型的双检锁单例模式。</p>
<p>继续跟进 <code>checkAndInitialzeGlide(context)</code></p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">checkAndInitializeGlide</span><span class="hljs-params">(@NonNull Context context)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-comment">// In the thread running initGlide(), one or more classes may call Glide.get(context).</span></span><br><span class="line">    <span class="hljs-comment">// Without this check, those calls could trigger infinite recursion.</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (isInitializing) &#123;</span><br><span class="line">      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalStateException(<span class="hljs-string">"You cannot call Glide.get() in registerComponents(),"</span></span><br><span class="line">          + <span class="hljs-string">" use the provided Glide instance instead"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    isInitializing = <span class="hljs-keyword">true</span>;</span><br><span class="line">    initializeGlide(context);</span><br><span class="line">    isInitializing = <span class="hljs-keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initializeGlide</span><span class="hljs-params">(@NonNull Context context)</span> </span>&#123;</span><br><span class="line">    initializeGlide(context, <span class="hljs-keyword">new</span> GlideBuilder());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@SuppressWarnings</span>(<span class="hljs-string">"deprecation"</span>)</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initializeGlide</span><span class="hljs-params">(@NonNull Context context, @NonNull GlideBuilder builder)</span> </span>&#123;</span><br><span class="line">    Context applicationContext = context.getApplicationContext();</span><br><span class="line">    <span class="hljs-comment">// 获取注解的 module</span></span><br><span class="line">    GeneratedAppGlideModule annotationGeneratedModule = getAnnotationGeneratedGlideModules();</span><br><span class="line">    List&lt;com.bumptech.glide.<span class="hljs-keyword">module</span>.GlideModule&gt; manifestModules = Collections.emptyList();</span><br><span class="line">    <span class="hljs-keyword">if</span> (annotationGeneratedModule == <span class="hljs-keyword">null</span> || annotationGeneratedModule.isManifestParsingEnabled()) &#123;</span><br><span class="line">        <span class="hljs-comment">// AndroidMenifest.xml 中注册的 module</span></span><br><span class="line">        manifestModules = <span class="hljs-keyword">new</span> ManifestParser(applicationContext).parse();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-comment">// 移除相同的GlideModule</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (annotationGeneratedModule != <span class="hljs-keyword">null</span></span><br><span class="line">            &amp;&amp; !annotationGeneratedModule.getExcludedModuleClasses().isEmpty()) &#123;</span><br><span class="line">        Set&lt;Class&lt;?&gt;&gt; excludedModuleClasses =</span><br><span class="line">                annotationGeneratedModule.getExcludedModuleClasses();</span><br><span class="line">        Iterator&lt;com.bumptech.glide.<span class="hljs-keyword">module</span>.GlideModule&gt; iterator = manifestModules.iterator();</span><br><span class="line">        <span class="hljs-keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            com.bumptech.glide.<span class="hljs-keyword">module</span>.GlideModule current = iterator.next();</span><br><span class="line">            <span class="hljs-keyword">if</span> (!excludedModuleClasses.contains(current.getClass())) &#123;</span><br><span class="line">                <span class="hljs-keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            iterator.remove();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">if</span> (Log.isLoggable(TAG, Log.DEBUG)) &#123;</span><br><span class="line">        <span class="hljs-keyword">for</span> (com.bumptech.glide.<span class="hljs-keyword">module</span>.GlideModule glideModule : manifestModules) &#123;</span><br><span class="line">            Log.d(TAG, <span class="hljs-string">"Discovered GlideModule from manifest: "</span> + glideModule.getClass());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    RequestManagerRetriever.RequestManagerFactory factory =</span><br><span class="line">            annotationGeneratedModule != <span class="hljs-keyword">null</span></span><br><span class="line">                    ? annotationGeneratedModule.getRequestManagerFactory() : <span class="hljs-keyword">null</span>;</span><br><span class="line">    builder.setRequestManagerFactory(factory);</span><br><span class="line">    <span class="hljs-keyword">for</span> (com.bumptech.glide.<span class="hljs-keyword">module</span>.GlideModule <span class="hljs-keyword">module</span> : manifestModules) &#123;</span><br><span class="line">        <span class="hljs-keyword">module</span>.applyOptions(applicationContext, builder);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">if</span> (annotationGeneratedModule != <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">        annotationGeneratedModule.applyOptions(applicationContext, builder);</span><br><span class="line">    &#125;</span><br><span class="line">    Glide glide = builder.build(applicationContext);</span><br><span class="line">    <span class="hljs-keyword">for</span> (com.bumptech.glide.<span class="hljs-keyword">module</span>.GlideModule <span class="hljs-keyword">module</span> : manifestModules) &#123;</span><br><span class="line">        <span class="hljs-keyword">module</span>.registerComponents(applicationContext, glide, glide.registry);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">if</span> (annotationGeneratedModule != <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">        annotationGeneratedModule.registerComponents(applicationContext, glide, glide.registry);</span><br><span class="line">    &#125;</span><br><span class="line">    applicationContext.registerComponentCallbacks(glide);</span><br><span class="line">    Glide.glide = glide;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>留意最后将初始化得到的glide赋值给了Glide.glide的单例。</p>
<p>接下里就来看看在这初始化方法中，Glide都加载了哪些配置。</p>
<h3 id="2-GlideModule配置加载"><a href="#2-GlideModule配置加载" class="headerlink" title="2. GlideModule配置加载"></a>2. GlideModule配置加载</h3><p>在使用 Glide 的时候，我们都会有一些想要设置的系统级配置，如设置缓存的存储位置，缓存区的大小，网络加载模块等等，那么我们通常就是使用 <code>GldieModule</code> 进行配置。在 Glide3.x 中，我们首先会定义一个继承于 <code>GlideModule</code> 的类，然后在项目的 <code>AndroidMenifest.xml</code> 中进行指定：</p>
<figure class="highlight xml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">meta-data</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"com.test.GlideConfiguration"</span></span></span><br><span class="line"><span class="hljs-tag">           <span class="hljs-attr">android:value</span>=<span class="hljs-string">"GlideModule"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>而在 Glide4 中，提供另外一个配置的模式，那就是注解，并且不再继承 GlideModule ，而是继承 AppGlideModule 和 LibraryGlideModule，分别对应 Application 和 Library，使用 @GlideModule 注解进行标记。而 Glide3.x 中的配置方式已经建议放弃使用。示例如下：</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@GlideModule</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GlideConfiguration</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AppGlideModule</span> </span>&#123;</span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">applyOptions</span><span class="hljs-params">(Context context, GlideBuilder builder)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-comment">//设置缓存到外部存储器</span></span><br><span class="line">        builder.setDiskCache(<span class="hljs-keyword">new</span> ExternalPreferredCacheDiskCacheFactory(context)); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Glide 是如何对 GlideModule 的配置进行初始化的呢？</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Context applicationContext = context.getApplicationContext();</span><br><span class="line">GeneratedAppGlideModule annotationGeneratedModule = getAnnotationGeneratedGlideModules();</span><br><span class="line"></span><br><span class="line">List&lt;com.bumptech.glide.<span class="hljs-keyword">module</span>.GlideModule&gt; manifestModules = Collections.emptyList();</span><br><span class="line"><span class="hljs-keyword">if</span> (annotationGeneratedModule == <span class="hljs-keyword">null</span> || annotationGeneratedModule.isManifestParsingEnabled()) &#123;</span><br><span class="line">    manifestModules = <span class="hljs-keyword">new</span> ManifestParser(applicationContext).parse();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">if</span> (annotationGeneratedModule != <span class="hljs-keyword">null</span></span><br><span class="line">        &amp;&amp; !annotationGeneratedModule.getExcludedModuleClasses().isEmpty()) &#123;</span><br><span class="line">    Set&lt;Class&lt;?&gt;&gt; excludedModuleClasses =</span><br><span class="line">            annotationGeneratedModule.getExcludedModuleClasses();</span><br><span class="line">    Iterator&lt;com.bumptech.glide.<span class="hljs-keyword">module</span>.GlideModule&gt; iterator = manifestModules.iterator();</span><br><span class="line">    <span class="hljs-keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">        com.bumptech.glide.<span class="hljs-keyword">module</span>.GlideModule current = iterator.next();</span><br><span class="line">        <span class="hljs-keyword">if</span> (!excludedModuleClasses.contains(current.getClass())) &#123;</span><br><span class="line">            <span class="hljs-keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        iterator.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第二行代码中，<code>getAnnotationGeneratedGlideModules()</code> 会获取 Glide 注解自动生产的一个 Glide 的 Module 配置器。如下：</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Nullable</span></span><br><span class="line"><span class="hljs-meta">@SuppressWarnings</span>(&#123;<span class="hljs-string">"unchecked"</span>, <span class="hljs-string">"deprecation"</span>, <span class="hljs-string">"TryWithIdenticalCatches"</span>&#125;)</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> GeneratedAppGlideModule <span class="hljs-title">getAnnotationGeneratedGlideModules</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    GeneratedAppGlideModule result = <span class="hljs-keyword">null</span>;</span><br><span class="line">    <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">        Class&lt;GeneratedAppGlideModule&gt; clazz =</span><br><span class="line">                (Class&lt;GeneratedAppGlideModule&gt;)</span><br><span class="line">                        Class.forName(<span class="hljs-string">"com.bumptech.glide.GeneratedAppGlideModuleImpl"</span>);</span><br><span class="line">        result = clazz.getDeclaredConstructor().newInstance();</span><br><span class="line">    &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (Log.isLoggable(TAG, Log.WARN)) &#123;</span><br><span class="line">            Log.w(TAG, <span class="hljs-string">"Failed to find GeneratedAppGlideModule. You should include an"</span></span><br><span class="line">                    + <span class="hljs-string">" annotationProcessor compile dependency on com.github.bumptech.glide:compiler"</span></span><br><span class="line">                    + <span class="hljs-string">" in your application and a @GlideModule annotated AppGlideModule implementation or"</span></span><br><span class="line">                    + <span class="hljs-string">" LibraryGlideModules will be silently ignored"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-comment">// These exceptions can't be squashed across all versions of Android.</span></span><br><span class="line">    &#125; <span class="hljs-keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">        throwIncorrectGlideModule(e);</span><br><span class="line">    &#125; <span class="hljs-keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">        throwIncorrectGlideModule(e);</span><br><span class="line">    &#125; <span class="hljs-keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">        throwIncorrectGlideModule(e);</span><br><span class="line">    &#125; <span class="hljs-keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">        throwIncorrectGlideModule(e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中 <code>com.bumptech.glide.GeneratedAppGlideModuleImpl</code> 是在编译时由 Glide 生成的一个类，主要用于过滤不必要的 GlideModule ，以及提供一个请求检索器工厂，这个后面会讲到。</p>
<p>接下生成一个 Manifest 解析器 ManifestParser ，用于获取配置的 GlideModule ，并存放在 manifestModules 中。然后是一个判断</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">if</span> (annotationGeneratedModule != <span class="hljs-keyword">null</span></span><br><span class="line">        &amp;&amp; !annotationGeneratedModule.getExcludedModuleClasses().isEmpty()) &#123;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果条件成立，即编译时自动生成的类中，包含了需要排除的 GlideModule ，逐个将其移除。</p>
<p>接着以上代码，Glide 将逐个调用剩下的 GlideModule ，并回调 <code>applyOptions</code> 和 <code>registerComponents</code> 接口，这时，用户配置的 GlideModule 就会被调用，同时用户设置的参数也就被配置到 Glide 中。</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">RequestManagerRetriever.RequestManagerFactory factory =</span><br><span class="line">        annotationGeneratedModule != <span class="hljs-keyword">null</span></span><br><span class="line">                ? annotationGeneratedModule.getRequestManagerFactory() : <span class="hljs-keyword">null</span>;</span><br><span class="line">builder.setRequestManagerFactory(factory);</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 逐个回调用户配置的 GlideModule</span></span><br><span class="line"><span class="hljs-keyword">for</span> (com.bumptech.glide.<span class="hljs-keyword">module</span>.GlideModule <span class="hljs-keyword">module</span> : manifestModules) &#123;</span><br><span class="line">    <span class="hljs-keyword">module</span>.applyOptions(applicationContext, builder);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 回调注释标记的 AppGlideModule</span></span><br><span class="line"><span class="hljs-keyword">if</span> (annotationGeneratedModule != <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">    annotationGeneratedModule.applyOptions(applicationContext, builder);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 构造 Glide 实例</span></span><br><span class="line">Glide glide = builder.build(applicationContext);</span><br><span class="line"><span class="hljs-keyword">for</span> (com.bumptech.glide.<span class="hljs-keyword">module</span>.GlideModule <span class="hljs-keyword">module</span> : manifestModules) &#123;</span><br><span class="line">    <span class="hljs-keyword">module</span>.registerComponents(applicationContext, glide, glide.registry);</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">if</span> (annotationGeneratedModule != <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">    annotationGeneratedModule.registerComponents(applicationContext, glide, glide.registry);</span><br><span class="line">&#125;</span><br><span class="line">applicationContext.registerComponentCallbacks(glide);</span><br><span class="line">Glide.glide = glide;</span><br></pre></td></tr></table></figure>
<p>在以上代码中，发现一句代码，在回调 <code>registerComponents</code> 前，首先构建了 glide 的实例。</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Glide glide = builder.build(applicationContext);</span><br></pre></td></tr></table></figure>
<h3 id="3-GlideBuilder构建Glide单例"><a href="#3-GlideBuilder构建Glide单例" class="headerlink" title="3. GlideBuilder构建Glide单例"></a>3. GlideBuilder构建Glide单例</h3><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@NonNull</span></span><br><span class="line"><span class="hljs-function">Glide <span class="hljs-title">build</span><span class="hljs-params">(@NonNull Context context)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">     * 建立资源加载请求器，实际上是一个线程池，</span></span><br><span class="line"><span class="hljs-comment">     * 用于加载 URL 或者本地资源，即加载源数据</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (sourceExecutor == <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">        sourceExecutor = GlideExecutor.newSourceExecutor();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">     * 建立本地缓存资源加载请求器，也是一个线程池</span></span><br><span class="line"><span class="hljs-comment">     * 用于加载缓存在磁盘中的数据</span></span><br><span class="line"><span class="hljs-comment">     * 并且这个线程池不能用于加载 url 网络数据</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (diskCacheExecutor == <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">        diskCacheExecutor = GlideExecutor.newDiskCacheExecutor();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">     * 建立动画加载请求器，也是线程池</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (animationExecutor == <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">        animationExecutor = GlideExecutor.newAnimationExecutor();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">     * 内存计算器</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (memorySizeCalculator == <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">        memorySizeCalculator = <span class="hljs-keyword">new</span> MemorySizeCalculator.Builder(context).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">     * 网络链接状态检测器工厂，</span></span><br><span class="line"><span class="hljs-comment">     * 用于监听网络状态</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (connectivityMonitorFactory == <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">        connectivityMonitorFactory = <span class="hljs-keyword">new</span> DefaultConnectivityMonitorFactory();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">     * 建立 bitmap 资源缓存池，</span></span><br><span class="line"><span class="hljs-comment">     * 该缓存主要用于 bitmap 资源的缓存和回收，</span></span><br><span class="line"><span class="hljs-comment">     * 避免由于大量创建和回收 bitmap 导致内存抖动</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (bitmapPool == <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">        <span class="hljs-keyword">int</span> size = memorySizeCalculator.getBitmapPoolSize();</span><br><span class="line">        <span class="hljs-keyword">if</span> (size &gt; <span class="hljs-number">0</span>) &#123;</span><br><span class="line">            bitmapPool = <span class="hljs-keyword">new</span> LruBitmapPool(size);</span><br><span class="line">        &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            bitmapPool = <span class="hljs-keyword">new</span> BitmapPoolAdapter();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">     * 数组资源缓存池</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (arrayPool == <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">        arrayPool = <span class="hljs-keyword">new</span> LruArrayPool(memorySizeCalculator.getArrayPoolSizeInBytes());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">     * 内存缓存，用于缓存完成加载和显示的图片数据资源</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (memoryCache == <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">        memoryCache = <span class="hljs-keyword">new</span> LruResourceCache(memorySizeCalculator.getMemoryCacheSize());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">     * 本地磁盘缓存器，默认为存储在 app 内部私密目录</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (diskCacheFactory == <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">        diskCacheFactory = <span class="hljs-keyword">new</span> InternalCacheDiskCacheFactory(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">     * 创建图片加载引擎，用于执行图片加载请求驱动</span></span><br><span class="line"><span class="hljs-comment">     */</span>    </span><br><span class="line">    <span class="hljs-keyword">if</span> (engine == <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">        engine =</span><br><span class="line">                <span class="hljs-keyword">new</span> Engine(</span><br><span class="line">                        memoryCache,</span><br><span class="line">                        diskCacheFactory,</span><br><span class="line">                        diskCacheExecutor,</span><br><span class="line">                        sourceExecutor,</span><br><span class="line">                        GlideExecutor.newUnlimitedSourceExecutor(),</span><br><span class="line">                        GlideExecutor.newAnimationExecutor(),</span><br><span class="line">                        isActiveResourceRetentionAllowed);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">     * 建立请求索引器</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    RequestManagerRetriever requestManagerRetriever =</span><br><span class="line">            <span class="hljs-keyword">new</span> RequestManagerRetriever(requestManagerFactory);</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">     * 创建 Glide</span></span><br><span class="line"><span class="hljs-comment">     */</span>   </span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Glide(</span><br><span class="line">            context,</span><br><span class="line">            engine,</span><br><span class="line">            memoryCache,</span><br><span class="line">            bitmapPool,</span><br><span class="line">            arrayPool,</span><br><span class="line">            requestManagerRetriever,</span><br><span class="line">            connectivityMonitorFactory,</span><br><span class="line">            logLevel,</span><br><span class="line">            defaultRequestOptions.lock(),</span><br><span class="line">            defaultTransitionOptions);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过以上一系列工具的新建，Glide 建立了资源请求线程池，本地缓存加载线程池，动画线程池，内存缓存器，磁盘缓存工具等等，接着构造了 Engine 数据加载引擎，最后再将 Engine 注入 Glide ，构建 Glide 。</p>
<p>其中还建立了一个请求器索引器，用于索引 RequestManger ，后面我们再详细讲。</p>
<p>我们进入最后, 构建 Glide 。</p>
<h3 id="4-构建Glide，配置数据转换器-解码器-转码器-编码器"><a href="#4-构建Glide，配置数据转换器-解码器-转码器-编码器" class="headerlink" title="4. 构建Glide，配置数据转换器/解码器/转码器/编码器"></a>4. 构建Glide，配置数据转换器/解码器/转码器/编码器</h3><p>回到 Glide 中，看看 Glide 的构造函数，这是一个长得变态的构造函数（有200行），但是不必被它吓倒（好吧，其实第一次看到这里，我是被吓倒了，直接略过去了，限于文章篇幅，这里只截取了部分源码，仔细的话可以直接看源码），仔细分析一下，其实整个构造过程并没那么复杂。</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">Glide(</span><br><span class="line">        <span class="hljs-meta">@NonNull</span> Context context,</span><br><span class="line">        <span class="hljs-meta">@NonNull</span> Engine engine,</span><br><span class="line">        <span class="hljs-meta">@NonNull</span> MemoryCache memoryCache,</span><br><span class="line">        <span class="hljs-meta">@NonNull</span> BitmapPool bitmapPool,</span><br><span class="line">        <span class="hljs-meta">@NonNull</span> ArrayPool arrayPool,</span><br><span class="line">        <span class="hljs-meta">@NonNull</span> RequestManagerRetriever requestManagerRetriever,</span><br><span class="line">        <span class="hljs-meta">@NonNull</span> ConnectivityMonitorFactory connectivityMonitorFactory,</span><br><span class="line">        <span class="hljs-keyword">int</span> logLevel,</span><br><span class="line">        <span class="hljs-meta">@NonNull</span> RequestOptions defaultRequestOptions,</span><br><span class="line">        <span class="hljs-meta">@NonNull</span> Map&lt;Class&lt;?&gt;, TransitionOptions&lt;?, ?&gt;&gt; defaultTransitionOptions) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// 步骤1：赋值 GlideBuilder 注入的工具</span></span><br><span class="line">    <span class="hljs-keyword">this</span>.engine = engine;</span><br><span class="line">    <span class="hljs-keyword">this</span>.bitmapPool = bitmapPool;</span><br><span class="line">    <span class="hljs-keyword">this</span>.arrayPool = arrayPool;</span><br><span class="line">    <span class="hljs-keyword">this</span>.memoryCache = memoryCache;</span><br><span class="line">    <span class="hljs-keyword">this</span>.requestManagerRetriever = requestManagerRetriever;</span><br><span class="line">    <span class="hljs-keyword">this</span>.connectivityMonitorFactory = connectivityMonitorFactory;</span><br><span class="line"></span><br><span class="line">    DecodeFormat decodeFormat = defaultRequestOptions.getOptions().get(Downsampler.DECODE_FORMAT);</span><br><span class="line">    bitmapPreFiller = <span class="hljs-keyword">new</span> BitmapPreFiller(memoryCache, bitmapPool, decodeFormat);</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">final</span> Resources resources = context.getResources();</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// 步骤2：新建注册器</span></span><br><span class="line">    registry = <span class="hljs-keyword">new</span> Registry();</span><br><span class="line">    registry.register(<span class="hljs-keyword">new</span> DefaultImageHeaderParser());</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// 步骤3：构建编码器和解码器</span></span><br><span class="line">    Downsampler downsampler = <span class="hljs-keyword">new</span> Downsampler(registry.getImageHeaderParsers(),</span><br><span class="line">            resources.getDisplayMetrics(), bitmapPool, arrayPool);</span><br><span class="line">    ByteBufferGifDecoder byteBufferGifDecoder =</span><br><span class="line">            <span class="hljs-keyword">new</span> ByteBufferGifDecoder(context, registry.getImageHeaderParsers(), bitmapPool, arrayPool);</span><br><span class="line">    ResourceDecoder&lt;ParcelFileDescriptor, Bitmap&gt; parcelFileDescriptorVideoDecoder =</span><br><span class="line">            VideoDecoder.parcel(bitmapPool);</span><br><span class="line">    ByteBufferBitmapDecoder byteBufferBitmapDecoder = <span class="hljs-keyword">new</span> ByteBufferBitmapDecoder(downsampler);</span><br><span class="line">    StreamBitmapDecoder streamBitmapDecoder = <span class="hljs-keyword">new</span> StreamBitmapDecoder(downsampler, arrayPool);</span><br><span class="line">    ResourceDrawableDecoder resourceDrawableDecoder =</span><br><span class="line">            <span class="hljs-keyword">new</span> ResourceDrawableDecoder(context);</span><br><span class="line">    ResourceLoader.StreamFactory resourceLoaderStreamFactory =</span><br><span class="line">            <span class="hljs-keyword">new</span> ResourceLoader.StreamFactory(resources);</span><br><span class="line">    ResourceLoader.UriFactory resourceLoaderUriFactory =</span><br><span class="line">            <span class="hljs-keyword">new</span> ResourceLoader.UriFactory(resources);</span><br><span class="line">    ResourceLoader.FileDescriptorFactory resourceLoaderFileDescriptorFactory =</span><br><span class="line">            <span class="hljs-keyword">new</span> ResourceLoader.FileDescriptorFactory(resources);</span><br><span class="line">    ResourceLoader.AssetFileDescriptorFactory resourceLoaderAssetFileDescriptorFactory =</span><br><span class="line">            <span class="hljs-keyword">new</span> ResourceLoader.AssetFileDescriptorFactory(resources);</span><br><span class="line">    BitmapEncoder bitmapEncoder = <span class="hljs-keyword">new</span> BitmapEncoder(arrayPool);</span><br><span class="line"></span><br><span class="line">    BitmapBytesTranscoder bitmapBytesTranscoder = <span class="hljs-keyword">new</span> BitmapBytesTranscoder();</span><br><span class="line">    GifDrawableBytesTranscoder gifDrawableBytesTranscoder = <span class="hljs-keyword">new</span> GifDrawableBytesTranscoder();</span><br><span class="line"></span><br><span class="line">    ContentResolver contentResolver = context.getContentResolver();</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// 步骤4：开始注册各个类型对应的解码器和编码器  省略部分代码</span></span><br><span class="line">    registry</span><br><span class="line">            .append(ByteBuffer.class, <span class="hljs-keyword">new</span> ByteBufferEncoder())</span><br><span class="line">            .append(InputStream.class, <span class="hljs-keyword">new</span> StreamEncoder(arrayPool))</span><br><span class="line">            <span class="hljs-comment">/* Bitmaps */</span></span><br><span class="line">            .append(Registry.BUCKET_BITMAP, ByteBuffer.class, Bitmap.class, byteBufferBitmapDecoder)</span><br><span class="line">            .append(Registry.BUCKET_BITMAP, InputStream.class, Bitmap.class, streamBitmapDecoder)</span><br><span class="line">            <span class="hljs-comment">/* BitmapDrawables */</span></span><br><span class="line">            .append(</span><br><span class="line">                    Registry.BUCKET_BITMAP_DRAWABLE,</span><br><span class="line">                    ByteBuffer.class,</span><br><span class="line">                    BitmapDrawable.class,</span><br><span class="line">                    <span class="hljs-keyword">new</span> BitmapDrawableDecoder&lt;&gt;(resources, byteBufferBitmapDecoder))</span><br><span class="line">            <span class="hljs-comment">/* GIFs */</span></span><br><span class="line">            .append(</span><br><span class="line">                    Registry.BUCKET_GIF,</span><br><span class="line">                    InputStream.class,</span><br><span class="line">                    GifDrawable.class,</span><br><span class="line">                    <span class="hljs-keyword">new</span> StreamGifDecoder(registry.getImageHeaderParsers(), byteBufferGifDecoder, arrayPool))</span><br><span class="line">            .append(Registry.BUCKET_GIF, ByteBuffer.class, GifDrawable.class, byteBufferGifDecoder)</span><br><span class="line">            .append(GifDrawable.class, <span class="hljs-keyword">new</span> GifDrawableEncoder())</span><br><span class="line">            <span class="hljs-comment">/* GIF Frames */</span></span><br><span class="line">            <span class="hljs-comment">// Compilation with Gradle requires the type to be specified for UnitModelLoader here.</span></span><br><span class="line">            .append(</span><br><span class="line">                    GifDecoder.class, GifDecoder.class, UnitModelLoader.Factory.&lt;GifDecoder&gt;getInstance())</span><br><span class="line">            .append(</span><br><span class="line">                    Registry.BUCKET_BITMAP,</span><br><span class="line">                    GifDecoder.class,</span><br><span class="line">                    Bitmap.class,</span><br><span class="line">                    <span class="hljs-keyword">new</span> GifFrameResourceDecoder(bitmapPool))</span><br><span class="line">            <span class="hljs-comment">/* Drawables */</span></span><br><span class="line">            .append(Uri.class, Drawable.class, resourceDrawableDecoder)</span><br><span class="line">            .append(</span><br><span class="line">                    Uri.class, Bitmap.class, <span class="hljs-keyword">new</span> ResourceBitmapDecoder(resourceDrawableDecoder, bitmapPool))</span><br><span class="line">            <span class="hljs-comment">/* Files */</span></span><br><span class="line">            .register(<span class="hljs-keyword">new</span> ByteBufferRewinder.Factory())</span><br><span class="line">            .append(File.class, ByteBuffer.class, <span class="hljs-keyword">new</span> ByteBufferFileLoader.Factory())</span><br><span class="line">            </span><br><span class="line">            <span class="hljs-comment">// Compilation with Gradle requires the type to be specified for UnitModelLoader here.</span></span><br><span class="line">            .append(File.class, File.class, UnitModelLoader.Factory.&lt;File&gt;getInstance())</span><br><span class="line">            <span class="hljs-comment">/* Models */</span></span><br><span class="line">            .register(<span class="hljs-keyword">new</span> InputStreamRewinder.Factory(arrayPool))</span><br><span class="line">            .append(<span class="hljs-keyword">int</span>.class, InputStream.class, resourceLoaderStreamFactory)</span><br><span class="line">            </span><br><span class="line">            <span class="hljs-comment">/* Transcoders */</span></span><br><span class="line">            .register(</span><br><span class="line">                    Bitmap.class,</span><br><span class="line">                    BitmapDrawable.class,</span><br><span class="line">                    <span class="hljs-keyword">new</span> BitmapDrawableTranscoder(resources))</span><br><span class="line">            .register(Bitmap.class, <span class="hljs-keyword">byte</span>[].class, bitmapBytesTranscoder);</span><br><span class="line">                </span><br><span class="line">    </span><br><span class="line">    <span class="hljs-comment">// 步骤5：新建图片显示目标对象工厂，并构建 Glide 上下文</span></span><br><span class="line">    ImageViewTargetFactory imageViewTargetFactory = <span class="hljs-keyword">new</span> ImageViewTargetFactory();</span><br><span class="line">    glideContext =</span><br><span class="line">            <span class="hljs-keyword">new</span> GlideContext(</span><br><span class="line">                    context,</span><br><span class="line">                    arrayPool,</span><br><span class="line">                    registry,</span><br><span class="line">                    imageViewTargetFactory,</span><br><span class="line">                    defaultRequestOptions,</span><br><span class="line">                    defaultTransitionOptions,</span><br><span class="line">                    engine,</span><br><span class="line">                    logLevel);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中最重要的是步骤3和步骤4，分别为 Glide 初始化了模型转换加载器，解码器，转码器，编码器，并将对各种类型进行一一注册，将其列成表格如下：</p>
<ul>
<li>模型转换器</li>
</ul>
<table>
<thead>
<tr>
<th>转换器</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td>ResourceLoader.StreamFactory</td>
<td>将Android资源ID转换为Uri，在加载成为InputStream</td>
</tr>
<tr>
<td>ResourceLoader.UriFactory</td>
<td>将资源ID转换为Uri</td>
</tr>
<tr>
<td>ResourceLoader.FileDescriptorFactory</td>
<td>将资源ID转化为ParcelFileDescriptor</td>
</tr>
<tr>
<td>ResourceLoader.AssetFileDescriptorFactory</td>
<td>将资源ID转化为AssetFileDescriptor</td>
</tr>
<tr>
<td>UnitModelLoader.Factory</td>
<td>不做任何转换，返回源数据</td>
</tr>
<tr>
<td>ByteBufferFileLoader.Factory</td>
<td>将File转换为ByteBuffer</td>
</tr>
<tr>
<td>FileLoader.StreamFactory</td>
<td>将File转换为InputStream</td>
</tr>
<tr>
<td>FileLoader.FileDescriptorFactory</td>
<td>将File转化为ParcelFileDescriptor</td>
</tr>
<tr>
<td>DataUrlLoader.StreamFactory</td>
<td>将Url转化为InputStream</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
<ul>
<li>解码器</li>
</ul>
<table>
<thead>
<tr>
<th>解码器</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td>ByteBufferGifDecoder</td>
<td>将ByteBuffer解码为GifDrawable</td>
</tr>
<tr>
<td>ByteBufferBitmapDecoder</td>
<td>将ByteBuffer解码为Bitmap</td>
</tr>
<tr>
<td>ResourceDrawableDecoder</td>
<td>将资源Uri解码为Drawable</td>
</tr>
<tr>
<td>ResourceBitmapDecoder</td>
<td>将资源ID解码为Bitmap</td>
</tr>
<tr>
<td>BitmapDrawableDecoder</td>
<td>将数据解码为BitmapDrawable</td>
</tr>
<tr>
<td>StreamBitmapDecoder</td>
<td>将InputStreams解码为Bitmap</td>
</tr>
<tr>
<td>StreamGifDecoder</td>
<td>将InputStream数据转换为BtyeBuffer，再解码为GifDrawable</td>
</tr>
<tr>
<td>GifFrameResourceDecoder</td>
<td>解码gif帧</td>
</tr>
<tr>
<td>FileDecoder</td>
<td>包装File成为FileResource</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
<ul>
<li>转码器</li>
</ul>
<table>
<thead>
<tr>
<th>转码器</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td>BitmapDrawableTranscoder</td>
<td>将Bitmap转码为BitmapDrawable</td>
</tr>
<tr>
<td>BitmapBytesTranscoder</td>
<td>将Bitmap转码为Byte arrays</td>
</tr>
<tr>
<td>DrawableBytesTranscoder</td>
<td>将BitmapDrawable转码为Byte arrays</td>
</tr>
<tr>
<td>GifDrawableBytesTranscoder</td>
<td>将GifDrawable转码为Byte arrays</td>
</tr>
</tbody>
</table>
<ul>
<li>编码器</li>
</ul>
<table>
<thead>
<tr>
<th>编码器</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td>ByteBufferEncoder</td>
<td>将Byte数据缓存为File</td>
</tr>
<tr>
<td>StreamEncoder</td>
<td>InputStream缓存为File</td>
</tr>
<tr>
<td>BitmapEncoder</td>
<td>将Bitmap数据缓存为File</td>
</tr>
<tr>
<td>BitmapDrawableEncoder</td>
<td>将BitmapDrawable数据缓存为File</td>
</tr>
<tr>
<td>GifDrawableEncoder</td>
<td>将GifDrawable数据缓存为File</td>
</tr>
</tbody>
</table>
<ul>
<li>模型转换注册表（实在太多，只列出了部分）</li>
</ul>
<table>
<thead>
<tr>
<th>源数据</th>
<th>转换数据</th>
<th>转换器</th>
</tr>
</thead>
<tbody>
<tr>
<td>Integer.class</td>
<td>InputStream.class</td>
<td>ResourceLoader.StreamFactory</td>
</tr>
<tr>
<td>String.class</td>
<td>InputStream.class</td>
<td>DataUrlLoader.StreamFactory</td>
</tr>
<tr>
<td>Uri.class</td>
<td>InputStream.class</td>
<td>DataUrlLoader.StreamFactory</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
<p><strong>以上模型转换注册表非常重要，在Glide进入解码流程时，将会遍历这里注册的所有可能转换的情形，尝试进行数据转换。</strong></p>
<p>这里只列出部分情形，其它还包括 File/Bitmap/Drawable/Byte 等等几乎涵括了日常使用的情况。</p>
<p>Glide的加载流程可以概括为以下流程：</p>
<p><code>model(数据源)--&gt;data(转换数据)--&gt;decode(解码)--&gt;transformed(缩放)--&gt;transcoded(转码)--&gt;encoded(编码保存到本地)</code></p>
<p>其中，transformed 为对解码得到的图片数据进行缩放，如 FitCenter、CropCenter 等。</p>
<p>到这里，Glide 单例就构建完成了，让我们返回到 Glide#with 中</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="hljs-meta">@NonNull</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> RequestManager <span class="hljs-title">with</span><span class="hljs-params">(@NonNull FragmentActivity activity)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> getRetriever(activity).get(activity);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-meta">@NonNull</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> RequestManagerRetriever <span class="hljs-title">getRetriever</span><span class="hljs-params">(@Nullable Context context)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-comment">// Context could be null for other reasons (ie the user passes in null), but in practice it will</span></span><br><span class="line">    <span class="hljs-comment">// only occur due to errors with the Fragment lifecycle.</span></span><br><span class="line">    Preconditions.checkNotNull(</span><br><span class="line">        context,</span><br><span class="line">        <span class="hljs-string">"You cannot start a load on a not yet attached View or a Fragment where getActivity() "</span></span><br><span class="line">            + <span class="hljs-string">"returns null (which usually occurs when getActivity() is called before the Fragment "</span></span><br><span class="line">            + <span class="hljs-string">"is attached or after the Fragment is destroyed)."</span>);</span><br><span class="line">    <span class="hljs-keyword">return</span> Glide.get(context).getRequestManagerRetriever();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在构建好 Glide 后，通过 <code>getRequestManagerRetriever()</code> 将会得到一个 RequestManagerRetriever ，即 RequestManager 的检索器，RequestManagerRetriever#get() 将为每个请求页面创建一个 RequestManager。</p>
<p>还记得 GlideBuilder#build 提到的一句代码吗？<br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RequestManagerRetriever requestManagerRetriever =</span><br><span class="line">    <span class="hljs-keyword">new</span> RequestManagerRetriever(requestManagerFactory);</span><br></pre></td></tr></table></figure></p>
<p>没错，这里获取的就是它。这里就必须要讲到 Glide 数据请求的生命周期了。</p>
<p>我们都知道 Glide 会根据页面的生命周期来自动的开启和结束数据的请求，那么 Glide 是怎么做到的呢？</p>
<h3 id="5-生命周期管理"><a href="#5-生命周期管理" class="headerlink" title="5. 生命周期管理"></a>5. 生命周期管理</h3><p>我们进入 RequestManagerRetriever#get(Activity) 方法中。</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@SuppressWarnings</span>(<span class="hljs-string">"deprecation"</span>)</span><br><span class="line"><span class="hljs-meta">@NonNull</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> RequestManager <span class="hljs-title">get</span><span class="hljs-params">(@NonNull Activity activity)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (Util.isOnBackgroundThread()) &#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> get(activity.getApplicationContext());</span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">        assertNotDestroyed(activity);</span><br><span class="line">        android.app.FragmentManager fm = activity.getFragmentManager();</span><br><span class="line">        <span class="hljs-keyword">return</span> fragmentGet(</span><br><span class="line">            activity, fm, <span class="hljs-comment">/*parentHint=*/</span> <span class="hljs-keyword">null</span>, isActivityVisible(activity));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先，判断是否为后台线程，如果是，则使用 ApplicationContext 重新获取。<br>重点来看 else 代码块。先断言请求的页面是否已经销毁。否则获取当前页面的 FragmentManager，并传给 fragmentGet 方法。</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@SuppressWarnings</span>(&#123;<span class="hljs-string">"deprecation"</span>, <span class="hljs-string">"DeprecatedIsStillUsed"</span>&#125;)</span><br><span class="line"><span class="hljs-meta">@Deprecated</span></span><br><span class="line"><span class="hljs-meta">@NonNull</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> RequestManager <span class="hljs-title">fragmentGet</span><span class="hljs-params">(@NonNull Context context,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        @NonNull android.app.FragmentManager fm,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        @Nullable android.app.Fragment parentHint,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">boolean</span> isParentVisible)</span> </span>&#123;</span><br><span class="line">    RequestManagerFragment current = getRequestManagerFragment(fm, parentHint, isParentVisible);</span><br><span class="line">    RequestManager requestManager = current.getRequestManager();</span><br><span class="line">    <span class="hljs-keyword">if</span> (requestManager == <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">        <span class="hljs-comment">// TODO(b/27524013): Factor out this Glide.get() call.</span></span><br><span class="line">        Glide glide = Glide.get(context);</span><br><span class="line">        requestManager =</span><br><span class="line">            factory.build(</span><br><span class="line">                glide, current.getGlideLifecycle(), current.getRequestManagerTreeNode(), context);</span><br><span class="line">        current.setRequestManager(requestManager);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> requestManager;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-meta">@NonNull</span></span><br><span class="line"><span class="hljs-function">SupportRequestManagerFragment <span class="hljs-title">getSupportRequestManagerFragment</span><span class="hljs-params">(FragmentActivity activity)</span> </span>&#123;</span><br><span class="line">  <span class="hljs-keyword">return</span> getSupportRequestManagerFragment(</span><br><span class="line">      activity.getSupportFragmentManager(), <span class="hljs-comment">/*parentHint=*/</span> <span class="hljs-keyword">null</span>, isActivityVisible(activity));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 fragmentGet 中首先通过 getRequestManagerFragment() 来获取一个命名为 FRAGMENT_TAG 的 fragment，如不存在，则新建一个 RequestManagerFragment，并添加到当前页面中。</p>
<p>这里我们就可以猜到了，Glide 是通过在页面中添加一个 Fragment 来动态监听页面的创建和销毁，从而达到依赖页面生命周期，动态管理请求的目的。</p>
<p>在 RequestManagerFragment 构造函数中，注入了一个生命周期监听器 ActivityFragmentLifecycle，并在 Fragment 各个生命周期回调中，调用了对应的方法。</p>
<p>而 ActivityFragmentLifecycle 也紧接着会调用 lifecycleListener 监听器，而这个监听器其实就是 RequestManger。如下：<br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ActivityFragmentLifecycle</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Lifecycle</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Set&lt;LifecycleListener&gt; lifecycleListeners =</span><br><span class="line">        Collections.newSetFromMap(<span class="hljs-keyword">new</span> WeakHashMap&lt;LifecycleListener, Boolean&gt;());</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> isStarted;</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> isDestroyed;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addListener</span><span class="hljs-params">(@NonNull LifecycleListener listener)</span> </span>&#123;</span><br><span class="line">        lifecycleListeners.add(listener);</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">if</span> (isDestroyed) &#123;</span><br><span class="line">            listener.onDestroy();</span><br><span class="line">        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isStarted) &#123;</span><br><span class="line">            listener.onStart();</span><br><span class="line">        &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            listener.onStop();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">removeListener</span><span class="hljs-params">(@NonNull LifecycleListener listener)</span> </span>&#123;</span><br><span class="line">        lifecycleListeners.remove(listener);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">onStart</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        isStarted = <span class="hljs-keyword">true</span>;</span><br><span class="line">        <span class="hljs-keyword">for</span> (LifecycleListener lifecycleListener : Util.getSnapshot(lifecycleListeners)) &#123;</span><br><span class="line">            lifecycleListener.onStart();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">onStop</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        isStarted = <span class="hljs-keyword">false</span>;</span><br><span class="line">        <span class="hljs-keyword">for</span> (LifecycleListener lifecycleListener : Util.getSnapshot(lifecycleListeners)) &#123;</span><br><span class="line">            lifecycleListener.onStop();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">onDestroy</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        isDestroyed = <span class="hljs-keyword">true</span>;</span><br><span class="line">        <span class="hljs-keyword">for</span> (LifecycleListener lifecycleListener : Util.getSnapshot(lifecycleListeners)) &#123;</span><br><span class="line">            lifecycleListener.onDestroy();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>最后，RequestManagerRetriever#fragmentGet，判断这个Fragment的RequestManager是否存在，否则创建一个RequestManager，并将生命周期注入，同时RquestManager构建时，将会通过addListener注入生命周期回调（具体可以查看RequestManger构造函数）。</p>
<p><strong>最后，Glide#with终将得到一个RequestManager。</strong></p>
<p><strong>至此，Glide的加载过程就解析完毕了。总结一下整个流程：</strong></p>
<ul>
<li>通过AndroidManifest和@GlideModule注解获取用户自定义配置GlideModule，并调用其对应的方法</li>
<li>通过GlideBuilder构建Glide：<ol>
<li>新建线程池</li>
<li>新建图片缓存池和缓存池</li>
<li>新建内存缓存管理器</li>
<li>新建默认本地缓存管理器</li>
<li>新建请求引擎Engine</li>
<li>新建RequestManger检索器</li>
<li>新建Glide</li>
</ol>
</li>
<li>Glide构造方法中，新建模型转换器，解码器，转码器，编码器，以及生成Glide上下文GlideContext</li>
<li>通过RequestManager检索器，建立生命周期监听，并建立一个RequestManager</li>
</ul>
<h2 id="Glide与GlideApp"><a href="#Glide与GlideApp" class="headerlink" title="Glide与GlideApp"></a>Glide与GlideApp</h2><p>如果在项目中已经使用了 Glide3.x ，并且想要升级到 Glide4.x ，那么你会发现，原来使用链式调用进行参数配置的方法已经被修改了，同一个封装到了 RequesOptions 中，如下：<br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">RequestOptions options = <span class="hljs-keyword">new</span> RequestOptions()</span><br><span class="line">        .centerCrop()</span><br><span class="line">        .placeholder(R.mipmap.ic_launcher_round)</span><br><span class="line">        .error(R.mipmap.ic_launcher)</span><br><span class="line">        .priority(Priority.HIGH)</span><br><span class="line">        .diskCacheStrategy(DiskCacheStrategy.NONE);</span><br><span class="line">Glide.with(<span class="hljs-keyword">this</span>)</span><br><span class="line">        .load(ImageConfig.URL_GIF)</span><br><span class="line">        .apply(options)</span><br><span class="line">        .into(iv);</span><br></pre></td></tr></table></figure></p>
<p>这样的话升级后将导致大量的修改，当然你也可以自己封装一下，但是 Glide 已经为我们做好了兼容方案。</p>
<p>还记得初始化是通过 @GlideModule 注解来注册自定义配置吗？只要在项目中定义这么一个配置，那么 Glide 将会自动帮我们生成一个 GlideApp 模块，封装了 Glide3.x 中的调用方式。</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GlideConfiguration</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AppGlideModule</span> </span>&#123;</span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">applyOptions</span><span class="hljs-params">(Context context, GlideBuilder builder)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用如下，还是原来的配方，还是熟悉的味道～</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GlideApp.with(<span class="hljs-keyword">this</span>)</span><br><span class="line">        .load(ImageConfig.URL_WEBP)</span><br><span class="line">        .sizeMultiplier(<span class="hljs-number">0.5f</span>)</span><br><span class="line">        .centerCrop()</span><br><span class="line">        .diskCacheStrategy(DiskCacheStrategy.ALL)</span><br><span class="line">        .error(R.mipmap.ic_launcher)</span><br><span class="line">        .into(iv);</span><br></pre></td></tr></table></figure>
<p>如果你还觉得不爽，那么你甚至可以把GlideApp直接修改为Glide，实现几乎“无缝对接”。当然，你还是要修改引用路径的。</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@GlideModule</span>(glideName=<span class="hljs-string">"Glide"</span>)</span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GlideConfiguration</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AppGlideModule</span> </span>&#123;</span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">applyOptions</span><span class="hljs-params">(Context context, GlideBuilder builder)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>来源：</strong></p>
<ul>
<li><a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2018/0403/9555.html" target="_blank" rel="noopener">Android Glide4 源码解析–框架初始化</a></li>
</ul>

        </div>
        
        
        
    </div>
</div>





    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-03-30T13:20:50.000Z">2018-03-30</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Android/">Android</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    5 分钟 读完 (大约 705 个字)
                </span>
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/03/30/收藏/">收藏</a>
            
        </h1>
        <div class="content">
            <h1 id="View"><a href="#View" class="headerlink" title="View"></a>View</h1><ul>
<li><a href="http://hencoder.com/ui-1-1/" target="_blank" rel="noopener">HenCoder 自定义 View</a></li>
<li><a href="https://www.zhihu.com/question/27718787/answer/53012226" target="_blank" rel="noopener">如何高效学习Android动画？</a></li>
<li><a href="https://www.jianshu.com/p/e99b5e8bd67b" target="_blank" rel="noopener">图解 Android 事件分发机制</a></li>
<li><a href="https://www.jianshu.com/p/b30d5ff75176" target="_blank" rel="noopener">从Toast显示原理初窥Android窗口管理</a></li>
<li><a href="https://juejin.im/post/5a52b0e15188257345015ad3" target="_blank" rel="noopener">可视化 ListView 缓存机制，手摸手带你打通任督二脉</a></li>
<li><a href="https://www.jianshu.com/p/e497123652b5" target="_blank" rel="noopener">Android Transition Framework详解—超炫的动画框架</a></li>
</ul>
<h1 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h1><ul>
<li><a href="http://blog.csdn.net/shangmingchao/article/details/79199638" target="_blank" rel="noopener">Android Studio 构建那些事</a></li>
<li><a href="http://blog.csdn.net/bboyfeiyu/article/details/44563871" target="_blank" rel="noopener">Android源码设计模式分析</a></li>
<li><a href="https://www.tianmaying.com/tutorial/AndroidMVC" target="_blank" rel="noopener">Android App的设计架构：MVC,MVP,MVVM与架构经验谈</a></li>
<li><a href="https://juejin.im/post/59cace88f265da0648446780" target="_blank" rel="noopener">带你领略Clean架构的魅力</a></li>
<li><a href="https://www.jianshu.com/p/d9e4ddd1c530" target="_blank" rel="noopener">一个优秀的Android应用从建项目开始</a></li>
</ul>
<h1 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h1><ul>
<li><a href="https://www.zhihu.com/question/34652589/answer/90344494" target="_blank" rel="noopener">Android中为什么主线程不会因为Looper.loop()里的死循环卡死？</a></li>
<li><a href="https://www.zhihu.com/question/39440766/answer/89210950" target="_blank" rel="noopener">为什么 Android 要采用 Binder 作为 IPC 机制？</a></li>
</ul>
<h1 id="性能"><a href="#性能" class="headerlink" title="性能"></a>性能</h1><ul>
<li><a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0920/3478.html" target="_blank" rel="noopener">Android内存优化之OOM</a></li>
</ul>
<h1 id="框架-库"><a href="#框架-库" class="headerlink" title="框架/库"></a>框架/库</h1><ul>
<li><a href="http://gank.io/post/560e15be2dca930e00da1083" target="_blank" rel="noopener">给 Android 开发者的 RxJava 详解</a></li>
<li><a href="https://github.com/Tim9Liu9/TimLiu-Android" target="_blank" rel="noopener">Android常用开源项目及库</a></li>
<li><a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0326/2643.html" target="_blank" rel="noopener">OKHttp源码解析</a></li>
<li><a href="https://www.jianshu.com/p/5ad013eb5364" target="_blank" rel="noopener">掘金 Android 文章精选合集</a></li>
<li><a href="https://github.com/chenpengfei88/StickyItemDecoration" target="_blank" rel="noopener">RecyclerView 使用ItemDecoration实现吸附效果</a></li>
</ul>
<h1 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h1><ul>
<li><a href="http://www.infoq.com/cn/articles/java-memory-model-1#" target="_blank" rel="noopener">深入理解Java内存模型（一）</a></li>
</ul>
<h1 id="面试"><a href="#面试" class="headerlink" title="面试"></a>面试</h1><ul>
<li><a href="https://github.com/AweiLoveAndroid/CommonDevKnowledge/blob/master/interview/contents/Android%E9%9D%A2%E8%AF%95%E9%A2%98.md" target="_blank" rel="noopener">Android面试题</a></li>
<li><a href="http://www.jackywang.tech/AndroidInterview-Q-A/chinese/" target="_blank" rel="noopener">国内一线互联网公司内部面试题库</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzI3OTU0MzI4MQ==&amp;mid=2247484068&amp;idx=1&amp;sn=1f92708a88365db24a78f3ccdfa1c922&amp;chksm=eb476e3adc30e72c89fc9d094e94bd51d067c40fa36300a56c2ce2d35204ab72a7844f367ea5&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">android2017经典面试题汇总</a></li>
<li><a href="https://juejin.im/post/598f00da51882548630c0eab#heading-10" target="_blank" rel="noopener">Android拿高薪面试题必看</a></li>
<li><a href="https://www.diycode.cc/wiki/androidinterview" target="_blank" rel="noopener">Android 开发工程师面试指南</a></li>
<li><a href="https://www.jianshu.com/p/89f19d67b348" target="_blank" rel="noopener">亲爱的面试官，这个我可没看过！</a></li>
</ul>
<h1 id="经验"><a href="#经验" class="headerlink" title="经验"></a>经验</h1><ul>
<li><a href="https://www.zhihu.com/question/33636939" target="_blank" rel="noopener">Android开发中，有哪些让你觉得相见恨晚的方法、类或接口？</a></li>
<li><a href="http://www.wanandroid.com/blog/show/2088" target="_blank" rel="noopener">有赞Android客户端网络架构演进</a></li>
<li><a href="http://www.wanandroid.com/blog/show/2085" target="_blank" rel="noopener">Android 测试相关的方方面面都在这儿</a></li>
</ul>
<h1 id="博客"><a href="#博客" class="headerlink" title="博客"></a>博客</h1><ul>
<li><a href="https://www.androidweekly.cn/" target="_blank" rel="noopener">Android 开发技术周报</a></li>
<li><a href="https://droidyue.com/" target="_blank" rel="noopener">技术小黑屋</a></li>
<li><a href="http://www.jcodecraeer.com/" target="_blank" rel="noopener">泡在网上的日子</a></li>
<li><a href="http://gank.io/" target="_blank" rel="noopener">干货集中营</a></li>
<li><a href="http://www.wanandroid.com/" target="_blank" rel="noopener">玩Android</a></li>
<li><a href="http://gityuan.com/android/" target="_blank" rel="noopener">Android系统开篇</a></li>
<li><a href="http://hukai.me/android-training-course-in-chinese/index.html" target="_blank" rel="noopener">Android官方培训课程</a></li>
<li><a href="http://blog.csdn.net/column/details/androidluo.html" target="_blank" rel="noopener">老罗的Android之旅</a></li>
</ul>
<h1 id="书籍"><a href="#书籍" class="headerlink" title="书籍"></a>书籍</h1><ul>
<li><a href="https://book.douban.com/subject/26599538/" target="_blank" rel="noopener">Android开发艺术探索</a></li>
</ul>

        </div>
        
        
        
    </div>
</div>





    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-03-30T13:13:13.000Z">2018-03-30</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Android/">Android</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    7 分钟 读完 (大约 1001 个字)
                </span>
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/03/30/AIDL/">AIDL</a>
            
        </h1>
        <div class="content">
            <p><strong>Book.java</strong><br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">package</span> com.honszeal.processdemo;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">import</span> android.os.Parcel;</span><br><span class="line"><span class="hljs-keyword">import</span> android.os.Parcelable;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * date：2018/3/13 on 16:07</span></span><br><span class="line"><span class="hljs-comment"> * desc:</span></span><br><span class="line"><span class="hljs-comment"> * author: liuch</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Parcelable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> bookId;</span><br><span class="line">    <span class="hljs-keyword">private</span> String bookName;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-title">Book</span><span class="hljs-params">(Parcel in)</span> </span>&#123;</span><br><span class="line">        bookId = in.readInt();</span><br><span class="line">        bookName = in.readString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Creator&lt;Book&gt; CREATOR = <span class="hljs-keyword">new</span> Creator&lt;Book&gt;() &#123;</span><br><span class="line">        <span class="hljs-meta">@Override</span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> Book <span class="hljs-title">createFromParcel</span><span class="hljs-params">(Parcel in)</span> </span>&#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Book(in);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-meta">@Override</span></span><br><span class="line">        <span class="hljs-keyword">public</span> Book[] newArray(<span class="hljs-keyword">int</span> size) &#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Book[size];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">describeContents</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">writeToParcel</span><span class="hljs-params">(Parcel dest, <span class="hljs-keyword">int</span> flags)</span> </span>&#123;</span><br><span class="line">        dest.writeInt(bookId);</span><br><span class="line">        dest.writeString(bookName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="IDE-自动完成"><a href="#IDE-自动完成" class="headerlink" title="IDE 自动完成"></a>IDE 自动完成</h2><p><strong>Book.aidl</strong><br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">package</span> com.honszeal.processdemo;</span><br><span class="line"></span><br><span class="line">parcelable Book;</span><br></pre></td></tr></table></figure></p>
<p><strong>ILibraryManager.aidl</strong><br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">package</span> com.honszeal.processdemo;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">import</span> com.honszeal.processdemo.Book;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ILibraryManager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function">List&lt;Book&gt; <span class="hljs-title">getNewBookList</span><span class="hljs-params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">donateBook</span><span class="hljs-params">(in Book book)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">log</span><span class="hljs-params">(String message)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>编译一下</p>
<p>切换到 <code>project</code> 选项卡，在 <code>app -&gt; build -&gt; generated -&gt; source -&gt; aidl -&gt; debug -&gt; 包名</code> 下 找到系统生成的<code>ILibraryManager.java</code><br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">package</span> com.honszeal.processdemo;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ILibraryManager</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">android</span>.<span class="hljs-title">os</span>.<span class="hljs-title">IInterface</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Stub</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">android</span>.<span class="hljs-title">os</span>.<span class="hljs-title">Binder</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">com</span>.<span class="hljs-title">honszeal</span>.<span class="hljs-title">processdemo</span>.<span class="hljs-title">ILibraryManager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> java.lang.String DESCRIPTOR = <span class="hljs-string">"com.honszeal.processdemo.ILibraryManager"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Stub</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">            <span class="hljs-keyword">this</span>.attachInterface(<span class="hljs-keyword">this</span>, DESCRIPTOR);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> com.honszeal.processdemo.<span class="hljs-function">ILibraryManager <span class="hljs-title">asInterface</span><span class="hljs-params">(android.os.IBinder obj)</span> </span>&#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> ((obj == <span class="hljs-keyword">null</span>)) &#123;</span><br><span class="line">                <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            android.os.IInterface iin = obj.queryLocalInterface(DESCRIPTOR);</span><br><span class="line">            <span class="hljs-keyword">if</span> (((iin != <span class="hljs-keyword">null</span>) &amp;&amp; (iin <span class="hljs-keyword">instanceof</span> com.honszeal.processdemo.ILibraryManager))) &#123;</span><br><span class="line">                <span class="hljs-keyword">return</span> ((com.honszeal.processdemo.ILibraryManager) iin);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> com.honszeal.processdemo.ILibraryManager.Stub.Proxy(obj);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-meta">@Override</span></span><br><span class="line">        <span class="hljs-keyword">public</span> android.os.<span class="hljs-function">IBinder <span class="hljs-title">asBinder</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-meta">@Override</span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">onTransact</span><span class="hljs-params">(<span class="hljs-keyword">int</span> code, android.os.Parcel data, android.os.Parcel reply, <span class="hljs-keyword">int</span> flags)</span> <span class="hljs-keyword">throws</span> android.os.RemoteException </span>&#123;</span><br><span class="line">            <span class="hljs-keyword">switch</span> (code) &#123;</span><br><span class="line">                <span class="hljs-keyword">case</span> INTERFACE_TRANSACTION: &#123;</span><br><span class="line">                    reply.writeString(DESCRIPTOR);</span><br><span class="line">                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="hljs-keyword">case</span> TRANSACTION_getNewBookList: &#123;</span><br><span class="line">                    data.enforceInterface(DESCRIPTOR);</span><br><span class="line">                    java.util.List&lt;com.honszeal.processdemo.Book&gt; _result = <span class="hljs-keyword">this</span>.getNewBookList();</span><br><span class="line">                    reply.writeNoException();</span><br><span class="line">                    reply.writeTypedList(_result);</span><br><span class="line">                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="hljs-keyword">case</span> TRANSACTION_donateBook: &#123;</span><br><span class="line">                    data.enforceInterface(DESCRIPTOR);</span><br><span class="line">                    com.honszeal.processdemo.Book _arg0;</span><br><span class="line">                    <span class="hljs-keyword">if</span> ((<span class="hljs-number">0</span> != data.readInt())) &#123;</span><br><span class="line">                        _arg0 = com.honszeal.processdemo.Book.CREATOR.createFromParcel(data);</span><br><span class="line">                    &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">                        _arg0 = <span class="hljs-keyword">null</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="hljs-keyword">this</span>.donateBook(_arg0);</span><br><span class="line">                    reply.writeNoException();</span><br><span class="line">                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.onTransact(code, data, reply, flags);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Proxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">com</span>.<span class="hljs-title">honszeal</span>.<span class="hljs-title">processdemo</span>.<span class="hljs-title">ILibraryManager</span> </span>&#123;</span><br><span class="line">            <span class="hljs-keyword">private</span> android.os.IBinder mRemote;</span><br><span class="line"></span><br><span class="line">            Proxy(android.os.IBinder remote) &#123;</span><br><span class="line">                mRemote = remote;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="hljs-meta">@Override</span></span><br><span class="line">            <span class="hljs-keyword">public</span> android.os.<span class="hljs-function">IBinder <span class="hljs-title">asBinder</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">                <span class="hljs-keyword">return</span> mRemote;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="hljs-keyword">public</span> java.lang.<span class="hljs-function">String <span class="hljs-title">getInterfaceDescriptor</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">                <span class="hljs-keyword">return</span> DESCRIPTOR;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="hljs-meta">@Override</span></span><br><span class="line">            <span class="hljs-keyword">public</span> java.util.List&lt;com.honszeal.processdemo.Book&gt; getNewBookList() <span class="hljs-keyword">throws</span> android.os.RemoteException &#123;</span><br><span class="line">                android.os.Parcel _data = android.os.Parcel.obtain();</span><br><span class="line">                android.os.Parcel _reply = android.os.Parcel.obtain();</span><br><span class="line">                java.util.List&lt;com.honszeal.processdemo.Book&gt; _result;</span><br><span class="line">                <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">                    _data.writeInterfaceToken(DESCRIPTOR);</span><br><span class="line">                    mRemote.transact(Stub.TRANSACTION_getNewBookList, _data, _reply, <span class="hljs-number">0</span>);</span><br><span class="line">                    _reply.readException();</span><br><span class="line">                    _result = _reply.createTypedArrayList(com.honszeal.processdemo.Book.CREATOR);</span><br><span class="line">                &#125; <span class="hljs-keyword">finally</span> &#123;</span><br><span class="line">                    _reply.recycle();</span><br><span class="line">                    _data.recycle();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="hljs-keyword">return</span> _result;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="hljs-meta">@Override</span></span><br><span class="line">            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">donateBook</span><span class="hljs-params">(com.honszeal.processdemo.Book book)</span> <span class="hljs-keyword">throws</span> android.os.RemoteException </span>&#123;</span><br><span class="line">                android.os.Parcel _data = android.os.Parcel.obtain();</span><br><span class="line">                android.os.Parcel _reply = android.os.Parcel.obtain();</span><br><span class="line">                <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">                    _data.writeInterfaceToken(DESCRIPTOR);</span><br><span class="line">                    <span class="hljs-keyword">if</span> ((book != <span class="hljs-keyword">null</span>)) &#123;</span><br><span class="line">                        _data.writeInt(<span class="hljs-number">1</span>);</span><br><span class="line">                        book.writeToParcel(_data, <span class="hljs-number">0</span>);</span><br><span class="line">                    &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">                        _data.writeInt(<span class="hljs-number">0</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    mRemote.transact(Stub.TRANSACTION_donateBook, _data, _reply, <span class="hljs-number">0</span>);</span><br><span class="line">                    _reply.readException();</span><br><span class="line">                &#125; <span class="hljs-keyword">finally</span> &#123;</span><br><span class="line">                    _reply.recycle();</span><br><span class="line">                    _data.recycle();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> TRANSACTION_getNewBookList = (android.os.IBinder.FIRST_CALL_TRANSACTION + <span class="hljs-number">0</span>);</span><br><span class="line">        <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> TRANSACTION_donateBook = (android.os.IBinder.FIRST_CALL_TRANSACTION + <span class="hljs-number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">public</span> java.util.List&lt;com.honszeal.processdemo.Book&gt; getNewBookList() <span class="hljs-keyword">throws</span> android.os.RemoteException;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">donateBook</span><span class="hljs-params">(com.honszeal.processdemo.Book book)</span> <span class="hljs-keyword">throws</span> android.os.RemoteException</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>BookService.java</strong><br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BookService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Service</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">private</span> Binder binder = <span class="hljs-keyword">new</span> ILibraryManager.Stub() &#123;</span><br><span class="line">        <span class="hljs-meta">@Override</span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Book&gt; <span class="hljs-title">getNewBookList</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-meta">@Override</span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">donateBook</span><span class="hljs-params">(Book book)</span> <span class="hljs-keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">super</span>.onCreate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> IBinder <span class="hljs-title">onBind</span><span class="hljs-params">(Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> binder;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="手写"><a href="#手写" class="headerlink" title="手写"></a>手写</h2><p><strong>IBookManager.java</strong><br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">package</span> com.honszeal.processdemo;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">import</span> android.os.IInterface;</span><br><span class="line"><span class="hljs-keyword">import</span> android.os.RemoteException;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">IBookManager</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">IInterface</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    String DESCRIPTOR = <span class="hljs-string">"com.honszeal.processdemo.ILibraryManager"</span>;</span><br><span class="line">    <span class="hljs-keyword">int</span> TRANSACTION_getNewBookList = (android.os.IBinder.FIRST_CALL_TRANSACTION + <span class="hljs-number">0</span>);</span><br><span class="line">    <span class="hljs-keyword">int</span> TRANSACTION_donateBook = (android.os.IBinder.FIRST_CALL_TRANSACTION + <span class="hljs-number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function">List&lt;Book&gt; <span class="hljs-title">getNewBookList</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> RemoteException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">donateBook</span><span class="hljs-params">(Book book)</span> <span class="hljs-keyword">throws</span> RemoteException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>BookManagerImpl</strong><br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">package</span> com.honszeal.processdemo;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">import</span> android.os.Binder;</span><br><span class="line"><span class="hljs-keyword">import</span> android.os.IBinder;</span><br><span class="line"><span class="hljs-keyword">import</span> android.os.IInterface;</span><br><span class="line"><span class="hljs-keyword">import</span> android.os.Parcel;</span><br><span class="line"><span class="hljs-keyword">import</span> android.os.RemoteException;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BookManagerImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Binder</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">IBookManager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">BookManagerImpl</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">this</span>.attachInterface(<span class="hljs-keyword">this</span>, DESCRIPTOR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IBookManager <span class="hljs-title">asInterface</span><span class="hljs-params">(IBinder obj)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (obj == <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        IInterface iin = obj.queryLocalInterface(DESCRIPTOR);</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">if</span> (iin != <span class="hljs-keyword">null</span> &amp;&amp; iin <span class="hljs-keyword">instanceof</span> IBookManager) &#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> ((IBookManager) iin);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BookManagerImpl.Proxy(obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">onTransact</span><span class="hljs-params">(<span class="hljs-keyword">int</span> code, Parcel data, Parcel reply, <span class="hljs-keyword">int</span> flags)</span> <span class="hljs-keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">switch</span> (code) &#123;</span><br><span class="line">            <span class="hljs-keyword">case</span> INTERFACE_TRANSACTION:</span><br><span class="line">                reply.writeString(DESCRIPTOR);</span><br><span class="line">                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</span><br><span class="line">            <span class="hljs-keyword">case</span> TRANSACTION_getNewBookList:</span><br><span class="line">                data.enforceInterface(DESCRIPTOR);</span><br><span class="line">                List&lt;Book&gt; bookList = <span class="hljs-keyword">this</span>.getNewBookList();</span><br><span class="line">                reply.writeNoException();</span><br><span class="line">                reply.writeTypedList(bookList);</span><br><span class="line">                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</span><br><span class="line">            <span class="hljs-keyword">case</span> TRANSACTION_donateBook:</span><br><span class="line">                data.enforceInterface(DESCRIPTOR);</span><br><span class="line">                Book arg0;</span><br><span class="line">                <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> != data.readInt()) &#123;</span><br><span class="line">                    arg0 = Book.CREATOR.createFromParcel(data);</span><br><span class="line">                &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">                    arg0 = <span class="hljs-keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="hljs-keyword">this</span>.donateBook(arg0);</span><br><span class="line">                reply.writeNoException();</span><br><span class="line">                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.onTransact(code, data, reply, flags);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Book&gt; <span class="hljs-title">getNewBookList</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">donateBook</span><span class="hljs-params">(Book book)</span> <span class="hljs-keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> IBinder <span class="hljs-title">asBinder</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Proxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">IBookManager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">private</span> IBinder mRemote;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Proxy</span><span class="hljs-params">(IBinder mRemote)</span> </span>&#123;</span><br><span class="line">            <span class="hljs-keyword">this</span>.mRemote = mRemote;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getInterfaceDescriptor</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> DESCRIPTOR;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-meta">@Override</span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Book&gt; <span class="hljs-title">getNewBookList</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">            Parcel data = Parcel.obtain();</span><br><span class="line">            Parcel reply = Parcel.obtain();</span><br><span class="line"></span><br><span class="line">            List&lt;Book&gt; result;</span><br><span class="line"></span><br><span class="line">            data.writeInterfaceToken(getInterfaceDescriptor());</span><br><span class="line">            mRemote.transact(TRANSACTION_getNewBookList, data, reply, <span class="hljs-number">0</span>);</span><br><span class="line">            reply.readException();</span><br><span class="line">            result = reply.createTypedArrayList(Book.CREATOR);</span><br><span class="line">            <span class="hljs-keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-meta">@Override</span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">donateBook</span><span class="hljs-params">(Book book)</span> <span class="hljs-keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">            <span class="hljs-comment">//</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-meta">@Override</span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> IBinder <span class="hljs-title">asBinder</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> mRemote;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>感觉，就是具体的实现在服务端写，在客户端调用。实际上就是调用了 <code>Proxy</code> 的对应方法，然后 <code>Binder</code> 的 <code>transact</code> 方法 再就是 <code>onTransact</code> 方法。</p>
<h2 id="权限验证"><a href="#权限验证" class="headerlink" title="权限验证"></a>权限验证</h2><ol>
<li>在 <code>onBind</code> 中进行验证，验证不通过就直接返回 <code>null</code>, 这样验证失败的客户端直接无法绑定服务。</li>
<li>在 <code>onTransact</code> 中进行验证，验证不通过就直接返回 <code>false</code>。</li>
</ol>

        </div>
        
        
        
    </div>
</div>





    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-03-30T13:09:02.000Z">2018-03-30</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Android/">Android</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    11 分钟 读完 (大约 1700 个字)
                </span>
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/03/30/Android-性能优化/">Android 性能优化</a>
            
        </h1>
        <div class="content">
            <h1 id="布局优化"><a href="#布局优化" class="headerlink" title="布局优化"></a>布局优化</h1><ul>
<li>删除布局中无用的控件和层级，其次有选择的使用性能较低的 <code>ViewGroup</code>，比如 <code>RelativeLayout</code>, <code>ConstraintLayout</code> 。同样层级的话更优先选择使用 <code>LinearLayout</code>，因为<code>RelativeLayout</code> 的布局过程需要花费更多的 <code>CPU</code> 时间。如果需要嵌套的方式来做，更建议采用 <code>RelativeLayout</code> ，因为 <code>ViewGroup</code> 的嵌套就相当于增加了布局的层级，同样会降低程序的性能。</li>
<li>采用 <code>&lt;include&gt;</code> 标签，如果多个布局中需要一个相同的 <code>layout</code> ，可以使用<code>&lt;include&gt;</code> 来避免写重复的布局文件。</li>
<li>采用 <code>&lt;merge&gt;</code> 标签。一般和 <code>&lt;include&gt;</code> 标签一起使用而减少布局的层级。</li>
<li><code>ViewStub</code>。它非常轻量级，而且高/宽都是 0，因此它本身不参与任何的布局和绘制过程。<code>ViewStub</code> 的意义在于按需加载所需的布局文件，在实际开发中，有很多布局文件在正常情况下不会显示，这个时候就没有必要在整个界面初始化的时候将其加载进来，通过 <code>ViewStub</code> 就可以做到在使用的时候再加载。<figure class="highlight xml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">ViewStub</span></span></span><br><span class="line"><span class="hljs-tag">    <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/stub_import"</span></span></span><br><span class="line"><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span></span></span><br><span class="line"><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"match_parent"</span></span></span><br><span class="line"><span class="hljs-tag">    <span class="hljs-attr">android:layout_gravity</span>=<span class="hljs-string">"center"</span></span></span><br><span class="line"><span class="hljs-tag">    <span class="hljs-attr">android:inflatedId</span>=<span class="hljs-string">"@+id/id_login"</span></span></span><br><span class="line"><span class="hljs-tag">    <span class="hljs-attr">android:layout</span>=<span class="hljs-string">"@layout/refresh_layout"</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line">其中 stub_import 是 ViewStub 的 id，id_login 是 refresh_layout 这个布局根元素的 id, 需要加载 ViewStub 的布局时，有两种方式：</span><br><span class="line"></span><br><span class="line">((ViewStub)findViewById(R.id.stub_import)).setVisibility(View.VISIBLE);</span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line"></span><br><span class="line">View layout = ((ViewStub)findViewById(R.id.stub_import)).inflate();</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="绘制优化"><a href="#绘制优化" class="headerlink" title="绘制优化"></a>绘制优化</h1><p>绘制优化是指 <code>View</code> 的 <code>onDraw</code> 方法要避免执行大量的操作。</p>
<p><code>onDraw</code> 里不要创建新的局部对象 不要做耗时的操作。</p>
<h1 id="内存泄露优化"><a href="#内存泄露优化" class="headerlink" title="内存泄露优化"></a>内存泄露优化</h1><p>内存泄露优化分为两个方面，一方面是在开发过程中避免写出有内存泄漏的代码，另一方面是通过一些分析工具找出潜在的内存泄漏继而解决。</p>
<h2 id="场景1-静态变量导致的内存泄漏"><a href="#场景1-静态变量导致的内存泄漏" class="headerlink" title="场景1 静态变量导致的内存泄漏"></a>场景1 静态变量导致的内存泄漏</h2><p>下面的代码将导致 <code>Activity</code> 无法正常销毁，因为静态变量 <code>sContext</code> 引用了它。<br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Activity</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String TAG = <span class="hljs-string">"MainActivity"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Context sContext;</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main); </span><br><span class="line">        </span><br><span class="line">        sContext = <span class="hljs-keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>解决方案：</strong></p>
<ol>
<li>在 <code>onDestroy</code> 中释放 <code>sContext = null</code>。</li>
<li>变成虚引用 <code>private static WeakReference&lt;Context&gt; context</code>。</li>
</ol>
<h2 id="场景2-单例模式导致的内存泄漏"><a href="#场景2-单例模式导致的内存泄漏" class="headerlink" title="场景2 单例模式导致的内存泄漏"></a>场景2 单例模式导致的内存泄漏</h2><p>如下所示，提供一个单例模式的 <code>TestManager</code>，<code>TestManager</code>可以接受外部的注册并将外部的监听器存储起来。</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestManager</span></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">private</span> List&lt;OnDataArrivedListener&gt; mOnDataArrivedListeners = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SingletonHolder</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> TestManager INSTANCE = <span class="hljs-keyword">new</span> TestManager();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">TestManager</span><span class="hljs-params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> TestManager <span class="hljs-title">getInstance</span><span class="hljs-params">()</span></span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> SingletonHolder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title">registerListener</span><span class="hljs-params">(OnDataArrivedListener listener)</span></span>&#123;</span><br><span class="line">        <span class="hljs-keyword">if</span>(!mOnDataArrivedListeners.contains(listener))&#123;</span><br><span class="line">            mOnDataArrivedListeners.add(listener);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title">unregisterListener</span><span class="hljs-params">(OnDataArrivedListener listener)</span></span>&#123;</span><br><span class="line">        mOnDataArrivedListeners.remove(listener);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">OnDataArrivedListener</span></span>&#123;</span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">onDataArrived</span><span class="hljs-params">(Object data)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>让 <code>Activity</code> 实现 <code>OnDataArrivedListener</code> 并向 <code>TestManager</code> 注册监听，如下所示。下面的代码由于缺少解注册的操作而引起内存泄漏，泄露的原因是 <code>Activity</code> 的对象被单例模式的  <code>TestManager</code> 所持有，而单例模式的特点是其生命周期和 <code>Application</code> 保持一致，因此 <code>Activity</code> 无法被及时释放。</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends Activity&#123;</span><br><span class="line"></span><br><span class="line">    private static final String TAG = &quot;MainActivity&quot;;</span><br><span class="line">    </span><br><span class="line">    private static Context sContext;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main); </span><br><span class="line">        </span><br><span class="line">        TestManager.getInstance().registerListener(this);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>解决方案：</strong></p>
<p>在 <code>onDestroy</code> 中 <code>TestManager.getInstance().unregisterListener(this);</code>。</p>
<h2 id="场景3-属性动画导致的内存泄漏"><a href="#场景3-属性动画导致的内存泄漏" class="headerlink" title="场景3 属性动画导致的内存泄漏"></a>场景3 属性动画导致的内存泄漏</h2><p>属性动画中有一类无限循环的动画，如果在 <code>Activity</code> 中播放此类动画并且没有在 <code>onDestroy</code> 中去停止动画，那么动画会一直播放下去，尽管已经无法在页面上看到动画效果了，并且这个时候 <code>Activity</code> 的 <code>View</code> 会被动画持有，而 <code>View</code> 又持有了 <code>Activity</code>，最终 <code>Activity</code> 无法释放。</p>
<p><strong>解决方法</strong></p>
<p>是在 <code>onDestroy</code> 中停止动画。</p>
<h2 id="场景4-非静态内部类导致的内存泄漏"><a href="#场景4-非静态内部类导致的内存泄漏" class="headerlink" title="场景4 非静态内部类导致的内存泄漏"></a>场景4 非静态内部类导致的内存泄漏</h2><p>比如 <code>Handler</code><br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">private</span> MyHandler handler;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Handler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">private</span> WeakReference&lt;MainActivity&gt; reference;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyHandler</span><span class="hljs-params">(MainActivity activity)</span> </span>&#123;</span><br><span class="line">            reference = <span class="hljs-keyword">new</span> WeakReference&lt;&gt;(activity);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-meta">@Override</span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleMessage</span><span class="hljs-params">(Message msg)</span> </span>&#123;</span><br><span class="line">            <span class="hljs-comment">//<span class="hljs-doctag">TODO:</span> do something</span></span><br><span class="line">            reference.get().doSomeThing();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        handler = <span class="hljs-keyword">new</span> MyHandler(<span class="hljs-keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onDestroy</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        handler.removeMessages(<span class="hljs-number">1</span>);</span><br><span class="line">        <span class="hljs-keyword">super</span>.onDestroy();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="响应速度优化和-ANR-日志分析"><a href="#响应速度优化和-ANR-日志分析" class="headerlink" title="响应速度优化和 ANR 日志分析"></a>响应速度优化和 ANR 日志分析</h1><p>响应速度优化的核心思想是避免在主线程中做耗时操作。响应速度过慢更多的体现在 <code>Activity</code> 的启动速度上，如果在主线程中做太多事情，会导致 <code>Activity</code> 启动时出现黑屏现象，甚至出现 <code>ANR(Application not response)</code>。<code>Android</code> 规定，<code>Activity</code> 如果 5s 内无法响应屏幕触摸事件或者键盘输入事件就会出现 <code>ANR</code>， <code>BroadcastReceiver</code> 如果 10s 之内还未执行完操作也会出现 <code>ANR</code>，<code>Service</code>  如果 20s 之内还未执行完操作也会出现 <code>ANR</code>。</p>
<p>当一个进程发生了 <code>ANR</code> 以后，系统会在<code>data/anr</code> 目录下创建一个 <code>traces.txt</code>，通过分析这个文件就能定位出 <code>ANR</code> 的原因。</p>
<h1 id="ListView-优化-和-Bitmap-优化"><a href="#ListView-优化-和-Bitmap-优化" class="headerlink" title="ListView 优化 和 Bitmap 优化"></a>ListView 优化 和 Bitmap 优化</h1><h2 id="ListView-优化方式"><a href="#ListView-优化方式" class="headerlink" title="ListView 优化方式"></a>ListView 优化方式</h2><ul>
<li>布局复用</li>
<li>使用 <code>ViewHolder</code>，减小 <code>findViewById</code> 的使用，避免在 <code>getView</code> 中执行耗时操作</li>
<li>在列表快速滑动时不适合开启大量的异步任务的。</li>
<li>数据可以分页加载。</li>
<li>可以尝试开启硬件加速来使 <code>ListView</code> 的滑动更加流畅。</li>
<li>尽量让 ItemView 的 Layout 层次结构简单。</li>
<li>ItemView 元素避免半透明。</li>
<li>尽量能保证 Adapter 的 hasStableIds() 返回 true，这样在 notifyDataSetChanged() 的时候，如果 id 不变，ListView 将不会重新绘制这个 View，达到优化的目的。</li>
<li>每个 ItemView 不能太高，特别是不要超过屏幕的高度。</li>
</ul>
<h2 id="Bitmap-优化方式"><a href="#Bitmap-优化方式" class="headerlink" title="Bitmap 优化方式"></a>Bitmap 优化方式</h2><ul>
<li>加载合适尺寸的图片（二次采样，inSampleSize）。</li>
</ul>
<h1 id="线程优化"><a href="#线程优化" class="headerlink" title="线程优化"></a>线程优化</h1><p>线程优化的思想是使用线程池，避免程序中存在大量的 <code>Thread</code>。线程池可以重用内部的线程，从而避免了线程的创建和销毁所带来的性能开销，同时线程池还可以有效的控制线程池的最大并发数，避免大量的线程因互相抢占系统资源从而导致堵塞现象的发生。</p>
<h1 id="一些性能优化建议"><a href="#一些性能优化建议" class="headerlink" title="一些性能优化建议"></a>一些性能优化建议</h1><ul>
<li>避免创建过多的对象。</li>
<li>不要过多使用枚举，枚举占用的内存空间要比整形大。（不过枚举要是能影响性能的话，就太差了）</li>
<li>常量请使用 <code>static final</code> 来修饰。</li>
<li>使用 <code>Android</code> 特有的数据结构，比如 <code>SparseArray</code> 和 <code>Pair</code> 等。</li>
<li>适当使用软引用和弱引用。</li>
<li>尽量采用静态内部类，这样可以避免潜在的由于内部类而导致的内存泄漏。</li>
</ul>
<hr>

        </div>
        
        
        
    </div>
</div>






    
<div class="card card-transparent">
    <nav class="pagination is-centered" role="navigation" aria-label="pagination">
        <div class="pagination-previous is-invisible is-hidden-mobile">
            <a class="is-flex-grow has-text-black-ter" href="/categories/Android/page/0/">上一页</a>
        </div>
        <div class="pagination-next">
            <a class="is-flex-grow has-text-black-ter" href="/categories/Android/page/2/">下一页</a>
        </div>
        <ul class="pagination-list is-hidden-mobile">
            
            <li><a class="pagination-link is-current" href="/categories/Android/">1</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/categories/Android/page/2/">2</a></li>
            
        </ul>
    </nav>
</div>
</div>
                


<div class="column has-order-1 is-4-tablet is-4-desktop is-3-widescreen ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered">
                <div>
                    <img class="image is-128x128 has-mb-6" src="/images/ha.jpg">
                    
                    <p class="is-size-4 is-block">
                        changoal
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        十年之前和现在
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="material-icons is-size-5 has-mr-7">location_on</i>
                        <span>BeiJing</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered">
                <div>
                    <p class="heading">
                        文章
                    </p>
                    <p class="title has-text-weight-normal">
                        68
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered">
                <div>
                    <p class="heading">
                        分类
                    </p>
                    <p class="title has-text-weight-normal">
                        16
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered">
                <div>
                    <p class="heading">
                        标签
                    </p>
                    <p class="title has-text-weight-normal">
                        28
                    </p>
                </div>
            </div>
        </nav>
        <div class="level">
            <a class="level-item button is-link is-rounded" href="http://github.com/changoal">
                关注我</a>
        </div>
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white" target="_blank"
                title="Github" href="http://github.com/changoal">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white" target="_blank"
                title="Facebook" href="https://www.facebook.com/profile.php?id=100007037856923">
                
                <i class="fab fa-facebook"></i>
                
            </a>
            
            <a class="level-item button is-white" target="_blank"
                title="Twitter" href="http://twitter.com/Changoall">
                
                <i class="fab fa-twitter"></i>
                
            </a>
            
            <a class="level-item button is-white" target="_blank"
                title="Zhihu" href="http://www.zhihu.com/people/changoal">
                
                <i class="fab fa-zhihu"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        
    
        

<div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            链接
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level" href="http://blog.kinderriven.cn/" target="_blank">
                    <span class="level-left">
                        <span class="level-item">花月阁</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">http://blog.kinderriven.cn/</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level" href="http://blog.csdn.net/LEE18254290736" target="_blank">
                    <span class="level-left">
                        <span class="level-item">LEE</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">http://blog.csdn.net/LEE18254290736</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level" href="http://gongchen.net.cn/" target="_blank">
                    <span class="level-left">
                        <span class="level-item">宫晨写字的地方</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">http://gongchen.net.cn/</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level" href="http://blog.alrise.xyz/" target="_blank">
                    <span class="level-left">
                        <span class="level-item">求学</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">http://blog.alrise.xyz/</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level" href="http://leoshi.me/" target="_blank">
                    <span class="level-left">
                        <span class="level-item">Leo Shi</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">http://leoshi.me/</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level" href="http://2naive.cn/" target="_blank">
                    <span class="level-left">
                        <span class="level-item">大队长</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">http://2naive.cn/</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>


    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                分类
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/Android/">
            <span class="level-start">
                <span class="level-item">Android</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">16</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Java/">
            <span class="level-start">
                <span class="level-item">Java</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Python/">
            <span class="level-start">
                <span class="level-item">Python</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">10</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/Python/Django/">
            <span class="level-start">
                <span class="level-item">Django</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Python/爬虫/">
            <span class="level-start">
                <span class="level-item">爬虫</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">7</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/师太/">
            <span class="level-start">
                <span class="level-item">师太</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/想说的/">
            <span class="level-start">
                <span class="level-item">想说的</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/摄影/">
            <span class="level-start">
                <span class="level-item">摄影</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/数据结构/">
            <span class="level-start">
                <span class="level-item">数据结构</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/文字/">
            <span class="level-start">
                <span class="level-item">文字</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/文字/收藏/">
            <span class="level-start">
                <span class="level-item">收藏</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/生活/">
            <span class="level-start">
                <span class="level-item">生活</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/算法/">
            <span class="level-start">
                <span class="level-item">算法</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/编程思想/">
            <span class="level-start">
                <span class="level-item">编程思想</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/足球/">
            <span class="level-start">
                <span class="level-item">足球</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            标签云
        </h3>
        <a href="/tags/Android/" style="font-size: 20px;">Android</a> <a href="/tags/Android开发艺术探索/" style="font-size: 11.43px;">Android开发艺术探索</a> <a href="/tags/Django/" style="font-size: 14.29px;">Django</a> <a href="/tags/Java/" style="font-size: 11.43px;">Java</a> <a href="/tags/Lottie/" style="font-size: 10px;">Lottie</a> <a href="/tags/Python/" style="font-size: 18.57px;">Python</a> <a href="/tags/RecyclerView/" style="font-size: 10px;">RecyclerView</a> <a href="/tags/Scrapy/" style="font-size: 11.43px;">Scrapy</a> <a href="/tags/bug/" style="font-size: 10px;">bug</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/动态权限申请/" style="font-size: 10px;">动态权限申请</a> <a href="/tags/北漂/" style="font-size: 11.43px;">北漂</a> <a href="/tags/师太/" style="font-size: 12.86px;">师太</a> <a href="/tags/想说的/" style="font-size: 17.14px;">想说的</a> <a href="/tags/感悟/" style="font-size: 10px;">感悟</a> <a href="/tags/排序/" style="font-size: 10px;">排序</a> <a href="/tags/推荐/" style="font-size: 10px;">推荐</a> <a href="/tags/摄影/" style="font-size: 10px;">摄影</a> <a href="/tags/收藏/" style="font-size: 10px;">收藏</a> <a href="/tags/数据结构/" style="font-size: 11.43px;">数据结构</a> <a href="/tags/文字/" style="font-size: 10px;">文字</a> <a href="/tags/杂/" style="font-size: 12.86px;">杂</a> <a href="/tags/爬虫/" style="font-size: 15.71px;">爬虫</a> <a href="/tags/生活/" style="font-size: 10px;">生活</a> <a href="/tags/编程思想/" style="font-size: 10px;">编程思想</a> <a href="/tags/足球/" style="font-size: 12.86px;">足球</a> <a href="/tags/随笔/" style="font-size: 10px;">随笔</a> <a href="/tags/面试/" style="font-size: 10px;">面试</a>
    </div>
</div>

    
    
        <div class="card card-transparent is-hidden-widescreen">
        
            
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            
            <a href="/2018/09/28/Android流行ORM框架/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Android流行ORM框架">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-09-28T10:46:37.000Z">2018-09-28</time></div>
                    <a href="/2018/09/28/Android流行ORM框架/" class="has-link-black-ter is-size-6">Android流行ORM框架</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Android/">Android</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/09/28/法/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="法">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-09-28T03:19:43.000Z">2018-09-28</time></div>
                    <a href="/2018/09/28/法/" class="has-link-black-ter is-size-6">法</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/09/26/懒加载-fragment/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="懒加载 fragment">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-09-26T07:29:53.000Z">2018-09-26</time></div>
                    <a href="/2018/09/26/懒加载-fragment/" class="has-link-black-ter is-size-6">懒加载 fragment</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Android/">Android</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/09/26/Android-命名规范/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Android 命名规范">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-09-26T07:27:38.000Z">2018-09-26</time></div>
                    <a href="/2018/09/26/Android-命名规范/" class="has-link-black-ter is-size-6">Android 命名规范</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Android/">Android</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/07/21/告白/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="告白">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-07-21T02:13:48.000Z">2018-07-21</time></div>
                    <a href="/2018/07/21/告白/" class="has-link-black-ter is-size-6">告白</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                标签
            </h3>
            <ul class="menu-list">
                
                <li>
                    <a class="level is-marginless" href="/tags/Android/">
                        <span class="level-start">
                            <span class="level-item">Android</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">25</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Android开发艺术探索/">
                        <span class="level-start">
                            <span class="level-item">Android开发艺术探索</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">2</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Django/">
                        <span class="level-start">
                            <span class="level-item">Django</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">4</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Java/">
                        <span class="level-start">
                            <span class="level-item">Java</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">2</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Lottie/">
                        <span class="level-start">
                            <span class="level-item">Lottie</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Python/">
                        <span class="level-start">
                            <span class="level-item">Python</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">12</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/RecyclerView/">
                        <span class="level-start">
                            <span class="level-item">RecyclerView</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Scrapy/">
                        <span class="level-start">
                            <span class="level-item">Scrapy</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">2</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/bug/">
                        <span class="level-start">
                            <span class="level-item">bug</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/linux/">
                        <span class="level-start">
                            <span class="level-item">linux</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/动态权限申请/">
                        <span class="level-start">
                            <span class="level-item">动态权限申请</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/北漂/">
                        <span class="level-start">
                            <span class="level-item">北漂</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">2</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/师太/">
                        <span class="level-start">
                            <span class="level-item">师太</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">3</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/想说的/">
                        <span class="level-start">
                            <span class="level-item">想说的</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">8</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/感悟/">
                        <span class="level-start">
                            <span class="level-item">感悟</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/排序/">
                        <span class="level-start">
                            <span class="level-item">排序</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/推荐/">
                        <span class="level-start">
                            <span class="level-item">推荐</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/摄影/">
                        <span class="level-start">
                            <span class="level-item">摄影</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/收藏/">
                        <span class="level-start">
                            <span class="level-item">收藏</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/数据结构/">
                        <span class="level-start">
                            <span class="level-item">数据结构</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">2</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/文字/">
                        <span class="level-start">
                            <span class="level-item">文字</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/杂/">
                        <span class="level-start">
                            <span class="level-item">杂</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">3</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/爬虫/">
                        <span class="level-start">
                            <span class="level-item">爬虫</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">7</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/生活/">
                        <span class="level-start">
                            <span class="level-item">生活</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/编程思想/">
                        <span class="level-start">
                            <span class="level-item">编程思想</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/足球/">
                        <span class="level-start">
                            <span class="level-item">足球</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">3</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/随笔/">
                        <span class="level-start">
                            <span class="level-item">随笔</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/面试/">
                        <span class="level-start">
                            <span class="level-item">面试</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>
        
        </div>
    
</div>

                


<div class="column has-order-3 is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only">
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            
            <a href="/2018/09/28/Android流行ORM框架/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Android流行ORM框架">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-09-28T10:46:37.000Z">2018-09-28</time></div>
                    <a href="/2018/09/28/Android流行ORM框架/" class="has-link-black-ter is-size-6">Android流行ORM框架</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Android/">Android</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/09/28/法/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="法">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-09-28T03:19:43.000Z">2018-09-28</time></div>
                    <a href="/2018/09/28/法/" class="has-link-black-ter is-size-6">法</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/09/26/懒加载-fragment/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="懒加载 fragment">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-09-26T07:29:53.000Z">2018-09-26</time></div>
                    <a href="/2018/09/26/懒加载-fragment/" class="has-link-black-ter is-size-6">懒加载 fragment</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Android/">Android</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/09/26/Android-命名规范/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Android 命名规范">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-09-26T07:27:38.000Z">2018-09-26</time></div>
                    <a href="/2018/09/26/Android-命名规范/" class="has-link-black-ter is-size-6">Android 命名规范</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Android/">Android</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/07/21/告白/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="告白">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-07-21T02:13:48.000Z">2018-07-21</time></div>
                    <a href="/2018/07/21/告白/" class="has-link-black-ter is-size-6">告白</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                标签
            </h3>
            <ul class="menu-list">
                
                <li>
                    <a class="level is-marginless" href="/tags/Android/">
                        <span class="level-start">
                            <span class="level-item">Android</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">25</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Android开发艺术探索/">
                        <span class="level-start">
                            <span class="level-item">Android开发艺术探索</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">2</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Django/">
                        <span class="level-start">
                            <span class="level-item">Django</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">4</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Java/">
                        <span class="level-start">
                            <span class="level-item">Java</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">2</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Lottie/">
                        <span class="level-start">
                            <span class="level-item">Lottie</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Python/">
                        <span class="level-start">
                            <span class="level-item">Python</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">12</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/RecyclerView/">
                        <span class="level-start">
                            <span class="level-item">RecyclerView</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Scrapy/">
                        <span class="level-start">
                            <span class="level-item">Scrapy</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">2</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/bug/">
                        <span class="level-start">
                            <span class="level-item">bug</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/linux/">
                        <span class="level-start">
                            <span class="level-item">linux</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/动态权限申请/">
                        <span class="level-start">
                            <span class="level-item">动态权限申请</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/北漂/">
                        <span class="level-start">
                            <span class="level-item">北漂</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">2</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/师太/">
                        <span class="level-start">
                            <span class="level-item">师太</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">3</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/想说的/">
                        <span class="level-start">
                            <span class="level-item">想说的</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">8</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/感悟/">
                        <span class="level-start">
                            <span class="level-item">感悟</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/排序/">
                        <span class="level-start">
                            <span class="level-item">排序</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/推荐/">
                        <span class="level-start">
                            <span class="level-item">推荐</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/摄影/">
                        <span class="level-start">
                            <span class="level-item">摄影</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/收藏/">
                        <span class="level-start">
                            <span class="level-item">收藏</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/数据结构/">
                        <span class="level-start">
                            <span class="level-item">数据结构</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">2</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/文字/">
                        <span class="level-start">
                            <span class="level-item">文字</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/杂/">
                        <span class="level-start">
                            <span class="level-item">杂</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">3</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/爬虫/">
                        <span class="level-start">
                            <span class="level-item">爬虫</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">7</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/生活/">
                        <span class="level-start">
                            <span class="level-item">生活</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/编程思想/">
                        <span class="level-start">
                            <span class="level-item">编程思想</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/足球/">
                        <span class="level-start">
                            <span class="level-item">足球</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">3</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/随笔/">
                        <span class="level-start">
                            <span class="level-item">随笔</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/面试/">
                        <span class="level-start">
                            <span class="level-item">面试</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>
    
    
</div>

            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/icon_round.png" alt="" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2018 chang&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        href="http://github.com/ppoffice/hexo-theme-icarus">Icarus</a>
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Creative Commons" href="https://creativecommons.org/">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Download on GitHub" href="http://github.com/ppoffice/hexo-theme-icarus">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-CN");</script>


    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>
    <script>
        (function ($) {
            $(document).ready(function () {
                if (typeof($.fn.lightGallery) === 'function') {
                    $('.article').lightGallery({ selector: '.gallery-item' });
                }
                if (typeof($.fn.justifiedGallery) === 'function') {
                    $('.justified-gallery').justifiedGallery();
                }
            });
        })(jQuery);
    </script>
    

    
    
    
    <div id="outdated">
        <h6>Your browser is out-of-date!</h6>
        <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update my browser now </a></p>
        <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js"></script>
    <script>
        $(document).ready(function () {
            // plugin function, place inside DOM ready function
            outdatedBrowser({
                bgColor: '#f25648',
                color: '#ffffff',
                lowerThan: 'flex'
            })
        });
    </script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/animejs@2.2.0/anime.js"></script>
    <script>
    function isIE() {
        var ua = window.navigator.userAgent;
        var msie = ua.indexOf('MSIE ');
        var trident = ua.indexOf('Trident/');
        return (msie > 0 || trident > 0);
    }

    $(document).ready(function () {
        $('body').css('opacity', 1);
        if (!isIE()) {
            ['.main > .column:first-child .card',
            '.main > .column:nth-child(2) .card',
            '.main > .column:last-child .card'].map(function(target) {
                anime({
                    targets: target,
                    scale: [0.8, 1],
                    opacity: [0, 1],
                    duration: 300,
                    easing: 'easeOutSine',
                    delay: function(el, i, l) {
                        return i * 100;
                    }
                })
            });
    
            anime({
                targets: '.navbar-main',
                translateY: [-100, 0],
                opacity: [0, 1],
                duration: 300,
                easing: 'easeOutSine'
            });
        }
    });
    </script>
    

    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script>
    MathJax.Hub.Config({
        "HTML-CSS": {matchFontHeight: false},
        SVG: {matchFontHeight: false},
        CommonHTML: {matchFontHeight: false}
    });
</script>

    
    

<div id="back-to-top" class="is-flex is-flex-center is-hidden-tablet">
    <i class="material-icons">keyboard_arrow_up</i>
    <span class="is-size-7">
        回到顶端</span>
</div>
<script>
    $(document).ready(function () {
        var lastScrollTop = 0;
        $(window).scroll(function (event) {
            var scrollTop = $(this).scrollTop();
            if (scrollTop > lastScrollTop || scrollTop === 0) {
                $('#back-to-top').removeClass('is-active');
            } else {
                $('#back-to-top').addClass('is-active');
            }
            lastScrollTop = scrollTop;
        });
        $('#back-to-top').on('click', function () {
            $('body, html').animate({ scrollTop: 0 }, 400);
        });
    });
</script>


    
    

    
    
    
    

    


<script src="/js/main.js"></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="想要查找什么..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js"></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>